# RFC 12.3: æé«˜ AB ç¼“å­˜å‘½ä¸­ç‡

> **æ–‡æ¡£æ¥æº**  
> Confluence: https://doc.huanleguang.com/pages/viewpage.action?pageId=438705960

---

## æ–‡æ¡£æ¦‚è¿°

æœ¬ RFC ä¸“æ³¨äºè§£å†³ **AB å®éªŒå¯¼è‡´çš„ç¼“å­˜ç¢ç‰‡åŒ–é—®é¢˜**ï¼Œé€šè¿‡ä¼˜åŒ–ç¼“å­˜ç­–ç•¥æ˜¾è‘—æå‡ç™»å½•æ€ä¸‹çš„é¡µé¢ç¼“å­˜å‘½ä¸­ç‡ã€‚

**æ ¸å¿ƒç›®æ ‡**ï¼š
- ğŸ“ˆ æå‡ç™»å½•æ€ç¼“å­˜å‘½ä¸­ç‡ï¼šä» 10-15% â†’ 40-50%
- ğŸ¯ è§£å†³ç¼“å­˜ç¢ç‰‡åŒ–é—®é¢˜
- âš¡ æ”¹å–„é¡µé¢æ€§èƒ½æŒ‡æ ‡ï¼ˆTTFBã€LCPï¼‰
- ğŸ”§ åŒºåˆ†å…¬å…±å®éªŒå’Œç§æœ‰å®éªŒ

**ç›¸å…³æ–‡æ¡£**ï¼š
- å‰ç½®ï¼š[RFC 12.1: AB å®éªŒä¸ç¼“å­˜ç­–ç•¥æ”¹è¿›](09-ABå®éªŒ-RFC12.1-SSRåœºæ™¯ä¸‹çš„ABå®éªŒä¸ç¼“å­˜ç­–ç•¥æ”¹è¿›.md)
- å‰ç½®ï¼š[RFC 12.2: AB å®éªŒæ•°æ®è·å–ä¼˜åŒ–](10-ABå®éªŒ-RFC12.2-SSRåœºæ™¯ä¸‹çš„ABå®éªŒæ•°æ®è·å–ä¼˜åŒ–.md)

---

## ä¸€ã€èƒŒæ™¯ä¸é—®é¢˜

### 1.1 æ€§èƒ½ä¸‹é™ç°è±¡

**æ•°æ®è§‚å¯Ÿ**ï¼šä» 2025 å¹´ç¬¬ 5 å‘¨å¼€å§‹ï¼Œé¦–é¡µå’Œæ¨¡æ¿é¡µç­‰ SSR é¡µé¢çš„æ€§èƒ½æŒç»­ä¸‹é™

**æ€§èƒ½æŒ‡æ ‡è¶‹åŠ¿**ï¼š

| æ€§èƒ½æŒ‡æ ‡ | ç¬¬3å‘¨ | ç¬¬4å‘¨ | ç¬¬5å‘¨ | ç¬¬6å‘¨ | ç¬¬7å‘¨ | ç¬¬8å‘¨ | ç¬¬9å‘¨ |
|---------|-------|-------|-------|-------|-------|-------|-------|
| **é¦–é¡µ TTFB** | 611 ms | 798 ms | **1070.5 ms** | 1027 ms | 1104.8 ms | 1203.6 ms | 1201.6 ms |
| **é¦–é¡µ LCP** | 1556.5 ms | 1695.5 ms | **2145.3 ms** | 1956.3 ms | 2147.5 ms | 2239.9 ms | 2244 ms |

**è¶‹åŠ¿åˆ†æ**ï¼š

```
TTFB: 611ms â†’ 1201ms (â¬†ï¸ 96%)
LCP:  1556ms â†’ 2244ms (â¬†ï¸ 44%)
```

**å½±å“**ï¼š
- ğŸ”´ TTFB å¢åŠ è¿‘ 100%
- ğŸ”´ LCP ä»ä¼˜ç§€ï¼ˆ< 1.5sï¼‰é™åˆ°ä¸åŠæ ¼ï¼ˆ> 2sï¼‰
- ğŸ”´ ç”¨æˆ·ä½“éªŒæ˜æ˜¾ä¸‹é™

![æ€§èƒ½æŒ‡æ ‡è¶‹åŠ¿](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-13_11-43-3.png)

### 1.2 é—®é¢˜åˆ†æ

#### åˆ†ææ­¥éª¤

**æ­¥éª¤ 1ï¼šå…³è”åˆ†æ**

```
è§‚å¯Ÿï¼šæ€§èƒ½ä¸‹é™ å’Œ ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™ è¶‹åŠ¿ä¸€è‡´

ç»“è®ºï¼šæ€€ç–‘ç¼“å­˜å‘½ä¸­ç‡å½±å“äº†æ€§èƒ½
```

**æ­¥éª¤ 2ï¼šå®éªŒéªŒè¯**

```
å®éªŒï¼šç¬¬ 11 å‘¨ï¼Œå…³é—­é¦–é¡µçš„ AB ç¼“å­˜ key
   â†“
è§‚å¯Ÿï¼š
   - ç¼“å­˜å‘½ä¸­ç‡ä¸Šå‡ âœ…
   - TTFB å’Œ LCP ä¸‹é™ âœ…
   â†“
ç»“è®ºï¼šAB ç¼“å­˜ key ç¡®å®å½±å“æ€§èƒ½
```

**æ­¥éª¤ 3ï¼šè¯¦ç»†åˆ†æ**

| ç»´åº¦ | ç¼“å­˜å‘½ä¸­ç‡ | ç»“è®º |
|------|-----------|------|
| **æœªç™»å½•æ€** | ~60% | ğŸŸ¢ å¯æ¥å— |
| **å·²ç™»å½•æ€** | ~10-15% | ğŸ”´ ä¸¥é‡é—®é¢˜ |
| **æ•´ä½“** | ~35% | ğŸŸ¡ éœ€æ”¹å–„ |

**å…³é”®å‘ç°**ï¼šå…³é—­ AB ç¼“å­˜ key åï¼Œ**ç™»å½•æ€çš„ç¼“å­˜å‘½ä¸­ç‡æå‡æ˜æ˜¾**

![ç¼“å­˜å‘½ä¸­ç‡å¯¹æ¯”](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-13_11-58-47.png)
![é¡µé¢æ€§èƒ½å¯¹æ¯”](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-13_11-59-23.png)
![ç™»å½•æ€ç¼“å­˜åˆ†æ](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-13_13-45-17.png)

#### æ ¹æœ¬åŸå› 

**æœªç™»å½•æ€**ï¼š

```
ç¼“å­˜ Key = hash(URL + ab-test-id)

ç‰¹ç‚¹ï¼š
- ç”¨æˆ·ä¹‹é—´å¯ä»¥å…±äº«ç¼“å­˜
- ç¼“å­˜å‘½ä¸­ç‡ç›¸å¯¹è¾ƒé«˜ï¼ˆ~60%ï¼‰
- AB è°ƒæ•´ä¼šå½±å“ï¼Œä½†å½±å“é¢å¹¿ï¼Œæ–°ç¼“å­˜å¿«é€Ÿç§¯ç´¯
```

**å·²ç™»å½•æ€**ï¼š

```
ç¼“å­˜ Key = hash(URL + userId + orgId + ab-test-id)

é—®é¢˜ï¼š
1. userId å’Œ orgId å¯¼è‡´æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹ç¼“å­˜
2. ab-test-id è¿›ä¸€æ­¥åˆ†è£‚ç¼“å­˜
3. AB è°ƒæ•´åï¼Œæ‰€æœ‰ç”¨æˆ·çš„ç¼“å­˜éƒ½å¤±æ•ˆ
4. ç”¨æˆ·æ•°å¤šï¼Œç¼“å­˜ç¢ç‰‡åŒ–ä¸¥é‡

ç»“æœï¼š
- ç¼“å­˜å‘½ä¸­ç‡æä½ï¼ˆ~10-15%ï¼‰
```

**ç¼“å­˜ç¢ç‰‡åŒ–è®¡ç®—**ï¼š

```
å‡è®¾ï¼š
- 10,000 ä¸ªæ´»è·ƒç™»å½•ç”¨æˆ·
- 3 ä¸ª AB å®éªŒï¼Œæ¯ä¸ª 2 ç§æƒ…å†µ

ç¼“å­˜ç‰ˆæœ¬æ•° = 10,000 Ã— 2^3 = 80,000 ä¸ªç‰ˆæœ¬ âŒ

æ¯ä¸ªç‰ˆæœ¬çš„å‘½ä¸­æ¦‚ç‡ = 1 / 80,000 â‰ˆ 0.00125%
```

**é—®é¢˜æ€»ç»“**ï¼š

| å› ç´  | å½±å“ | ç¨‹åº¦ |
|------|------|------|
| **userId éš”ç¦»** | ç”¨æˆ·é—´æ— æ³•å…±äº«ç¼“å­˜ | ğŸ”´ é«˜ |
| **AB åˆ†è£‚** | æ¯ä¸ªå®éªŒ Ã— 2 ç‰ˆæœ¬ | ğŸ”´ é«˜ |
| **AB è°ƒæ•´** | æ—§ç¼“å­˜å…¨éƒ¨å¤±æ•ˆ | ğŸ”´ é«˜ |

---

## äºŒã€è§£å†³æ–¹æ¡ˆæ¢ç´¢

### 2.1 æ–¹æ¡ˆä¸€ï¼šç™»å½•æ€ä¸‹ç§»é™¤ ab-test-id

#### æ ¸å¿ƒæ€è·¯

**ç†è®ºä¾æ®**ï¼š

```
userId + orgId å·²ç»æ ‡è¯†äº†ç”¨æˆ·çš„å”¯ä¸€æ€§
   â†“
åŒä¸€ç”¨æˆ·åœ¨åŒä¸€æ—¶åˆ»åªä¼šå‘½ä¸­ä¸€ç§ AB ç»„
   â†“
ç†è®ºä¸Šä¸éœ€è¦ ab-test-id åŒºåˆ†ç¼“å­˜
```

**å®æ–½æ–¹æ¡ˆ**ï¼š

```javascript
// è®¡ç®—ç¼“å­˜ Key
function getCacheKey(url, userId, orgId, abTestId, isLoggedIn) {
  if (isLoggedIn) {
    // ç™»å½•æ€ï¼šä¸ä½¿ç”¨ ab-test-id
    return hash(url + userId + orgId);
  } else {
    // æœªç™»å½•æ€ï¼šä½¿ç”¨ ab-test-id
    return hash(url + abTestId);
  }
}
```

**é¢„æœŸæ•ˆæœ**ï¼š

```
ç¼“å­˜ç‰ˆæœ¬æ•° = 10,000 (ä»…æŒ‰ userId)
   vs
æ—§æ–¹æ¡ˆ = 10,000 Ã— 8 = 80,000

ç¼“å­˜ç¢ç‰‡åŒ–å‡å°‘ 8 å€ âœ…
```

#### é—®é¢˜å‘ç°ï¼šå…¬å…±ç»„ä»¶ä¸ä¸€è‡´

**æµ‹è¯•å‘ç°**ï¼šå»æ‰ ab-test-id åï¼Œ**å…¬å…±ç»„ä»¶åœ¨ä¸åŒé¡µé¢æ˜¾ç¤ºä¸ä¸€è‡´**

**æ¡ˆä¾‹**ï¼šä¾§è¾¹èœå•æ å®éªŒ

```
ç”¨æˆ·è®¿é—®é¦–é¡µï¼š
   â”œâ”€ ç¼“å­˜çŠ¶æ€ï¼šHITï¼ˆ1 åˆ†é’Ÿå‰ç¼“å­˜ï¼‰
   â”œâ”€ AB å®éªŒç‰ˆæœ¬ï¼šX
   â””â”€ ä¾§è¾¹èœå•æ ï¼šX ç‰ˆæœ¬

åŒä¸€ç”¨æˆ·è®¿é—®æ¨¡æ¿é¡µï¼š
   â”œâ”€ ç¼“å­˜çŠ¶æ€ï¼šMISSï¼ˆæ–°é¡µé¢æ— ç¼“å­˜ï¼‰
   â”œâ”€ AB å®éªŒç‰ˆæœ¬ï¼šYï¼ˆé…ç½®åˆšè°ƒæ•´ï¼‰
   â””â”€ ä¾§è¾¹èœå•æ ï¼šY ç‰ˆæœ¬

ç»“æœï¼š
   é¦–é¡µå’Œæ¨¡æ¿é¡µçš„ä¾§è¾¹æ ä¸ä¸€è‡´ âŒ
```

![é¦–é¡µä¾§è¾¹æ ](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-13_14-12-8.png)
![æ¨¡æ¿é¡µä¾§è¾¹æ ](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-13_14-1-22.png)

**åŸå› åˆ†æ**ï¼š

**ç¼“å­˜ä¼˜å…ˆç­–ç•¥**ï¼š

```
Cache-Control: max-age=600, stale-while-revalidate=604800, stale-if-error=604800

å«ä¹‰ï¼š
- æ–°é²œæœŸï¼š10 åˆ†é’Ÿ
- é™ˆæ—§å¯ç”¨æœŸï¼š7 å¤©ï¼ˆåå°æ›´æ–°ï¼‰
- é”™è¯¯é™çº§æœŸï¼š7 å¤©
```

**ç¼“å­˜è¡Œä¸º**ï¼š

```
0-10 åˆ†é’Ÿï¼š
   â† ç›´æ¥è¿”å›ç¼“å­˜ï¼ˆæ–°é²œï¼‰

10 åˆ†é’Ÿ - 7 å¤©ï¼š
   â† å…ˆè¿”å›æ—§ç¼“å­˜ï¼ˆé™ˆæ—§ä½†å¯ç”¨ï¼‰
   â† åŒæ—¶åå°è§¦å‘æ›´æ–°
   â† ä¸‹æ¬¡è®¿é—®è¿”å›æ–°ç¼“å­˜

> 7 å¤©ï¼š
   â† ç¼“å­˜è¿‡æœŸï¼Œå¼ºåˆ¶æ›´æ–°
```

**é—®é¢˜åœºæ™¯**ï¼š

| æƒ…å†µ | é¡µé¢ A | é¡µé¢ B | å…¬å…±ç»„ä»¶ | ä¸€è‡´æ€§ |
|------|--------|--------|---------|--------|
| **æƒ…å†µ 1** | MISS | MISS | éƒ½æ˜¯æ–°ç‰ˆæœ¬ | âœ… ä¸€è‡´ |
| **æƒ…å†µ 2** | HIT (æ—§) | MISS | A æ—§ã€B æ–° | âŒ ä¸ä¸€è‡´ |
| **æƒ…å†µ 3** | MISS | HIT (æ—§) | A æ–°ã€B æ—§ | âŒ ä¸ä¸€è‡´ |

**å…¬å…±å®éªŒå®šä¹‰**ï¼š

> **å…¬å…±å®éªŒ**ï¼šé¡µé¢ SSR æ¸²æŸ“å…±åŒä¾èµ–çš„ç»„ä»¶å®éªŒ

**ç¤ºä¾‹**ï¼š

| ç±»å‹ | æ˜¯å¦å…¬å…±å®éªŒ | åŸå›  |
|------|------------|------|
| **ä¾§è¾¹èœå•æ ** | âœ… æ˜¯ | åœ¨ SSR ä¸­æ¸²æŸ“ï¼Œå½±å“ HTML |
| **é¡¶éƒ¨å¯¼èˆªæ ** | âœ… æ˜¯ | åœ¨ SSR ä¸­æ¸²æŸ“ï¼Œå½±å“ HTML |
| **å¼¹çª—ç»„ä»¶** | âŒ å¦ | CSR æ¸²æŸ“ï¼Œä¸å½±å“ç¼“å­˜ |
| **å¼‚æ­¥åŠ è½½å†…å®¹** | âŒ å¦ | å®¢æˆ·ç«¯è·å–ï¼Œä¸å½±å“ç¼“å­˜ |

#### æ–¹æ¡ˆä¸€ç»“è®º

**ä¼˜ç‚¹**ï¼š
- âœ… å¤§å¹…å‡å°‘ç¼“å­˜ç¢ç‰‡åŒ–
- âœ… æå‡ç¼“å­˜å‘½ä¸­ç‡

**ç¼ºç‚¹**ï¼š
- âŒ å…¬å…±ç»„ä»¶åœ¨ä¸åŒé¡µé¢å¯èƒ½ä¸ä¸€è‡´
- âŒ ç”¨æˆ·ä½“éªŒå›°æƒ‘

**å†³ç­–**ï¼šâŒ **ä¸å¯æ¥å—**ï¼Œéœ€è¦å…¶ä»–æ–¹æ¡ˆ

---

### 2.2 æ–¹æ¡ˆäºŒï¼šè°ƒæ•´ ab-test-id ç”Ÿæˆè§„åˆ™ï¼ˆæ¨èï¼‰â­

#### æ ¸å¿ƒæ€è·¯

**è§‚å¯Ÿ**ï¼š

```
é—®é¢˜çš„å…³é”®åœ¨äºï¼š
   æ‰€æœ‰å®éªŒéƒ½å½±å“ ab-test-id
      â†“
   ä½†åªæœ‰å…¬å…±å®éªŒä¼šå¯¼è‡´ä¸ä¸€è‡´
      â†“
   è§£å†³æ–¹æ¡ˆï¼š
   åªå°†å…¬å…±å®éªŒçº³å…¥ ab-test-id è®¡ç®—
```

**æ–¹æ¡ˆè®¾è®¡**ï¼š

```
ç™»å½•æ€ä¸‹ï¼š
   ab-test-id = hash(ä»…å…¬å…±å®éªŒçš„æ•°æ®)

æœªç™»å½•æ€ï¼š
   ab-test-id = hash(æ‰€æœ‰å®éªŒçš„æ•°æ®) (ä¿æŒä¸å˜)
```

#### æ•ˆæœåˆ†æ

**å‡è®¾åœºæ™¯**ï¼š

```
å®éªŒé…ç½®ï¼š
   A: ä¾§è¾¹èœå•æ å®éªŒï¼ˆå…¬å…±ï¼‰
   B: é¦–é¡µæ¨èç®—æ³•ï¼ˆéå…¬å…±ï¼‰
   C: æ¨¡æ¿åˆ—è¡¨æ ·å¼ï¼ˆéå…¬å…±ï¼‰

æ¯ä¸ªå®éªŒ 2 ç§æƒ…å†µï¼šA1/A2, B1/B2, C1/C2
```

**æ‰€æœ‰å®éªŒå‚ä¸ vs ä»…å…¬å…±å®éªŒå‚ä¸**ï¼š

| å®éªŒç»„åˆ | A (å…¬å…±) | B | C | æ‰€æœ‰å®éªŒ ab-test-id | å…¬å…±å®éªŒ ab-test-id |
|---------|---------|---|---|-------------------|-------------------|
| ç‰ˆæœ¬ 1 | A1 | B1 | C1 | hash(A1B1C1) | hash(A1) |
| ç‰ˆæœ¬ 2 | A1 | B1 | C2 | hash(A1B1C2) | hash(A1) |
| ç‰ˆæœ¬ 3 | A1 | B2 | C1 | hash(A1B2C1) | hash(A1) |
| ç‰ˆæœ¬ 4 | A1 | B2 | C2 | hash(A1B2C2) | hash(A1) |
| ç‰ˆæœ¬ 5 | A2 | B1 | C1 | hash(A2B1C1) | hash(A2) |
| ç‰ˆæœ¬ 6 | A2 | B1 | C2 | hash(A2B1C2) | hash(A2) |
| ç‰ˆæœ¬ 7 | A2 | B2 | C1 | hash(A2B2C1) | hash(A2) |
| ç‰ˆæœ¬ 8 | A2 | B2 | C2 | hash(A2B2C2) | hash(A2) |

**ç¼“å­˜ç‰ˆæœ¬æ•°å¯¹æ¯”**ï¼š

```
æ‰€æœ‰å®éªŒï¼š2^3 = 8 ä¸ªç‰ˆæœ¬
å…¬å…±å®éªŒï¼š2^1 = 2 ä¸ªç‰ˆæœ¬

å‡å°‘ï¼š8 / 2 = 4 å€ âœ…
```

**ä¸€èˆ¬å…¬å¼**ï¼š

```
n ä¸ªå®éªŒï¼Œå…¶ä¸­ m ä¸ªå…¬å…±å®éªŒ

æ‰€æœ‰å®éªŒï¼š2^n ä¸ªç‰ˆæœ¬
å…¬å…±å®éªŒï¼š2^m ä¸ªç‰ˆæœ¬

ç¢ç‰‡åŒ–å‡å°‘ï¼š2^n / 2^m = 2^(n-m) å€
```

**å®é™…æ¡ˆä¾‹**ï¼š

```
å‡è®¾ï¼š5 ä¸ªå®éªŒï¼Œå…¶ä¸­ 1 ä¸ªå…¬å…±å®éªŒ

æ‰€æœ‰å®éªŒï¼š2^5 = 32 ä¸ªç‰ˆæœ¬
å…¬å…±å®éªŒï¼š2^1 = 2 ä¸ªç‰ˆæœ¬

å‡å°‘ï¼š32 / 2 = 16 å€ âœ…

ç¼“å­˜å‘½ä¸­ç‡ï¼š
   æ—§æ–¹æ¡ˆï¼š1/32 â‰ˆ 3%
   æ–°æ–¹æ¡ˆï¼š1/2 = 50%
   æå‡ï¼š16 å€ ğŸš€
```

#### æ–¹æ¡ˆæµç¨‹è®¾è®¡

**åŒºåˆ†ç™»å½•æ€**ï¼š

```javascript
// ç”Ÿæˆ ab-test-id
function generateABTestId(abData, isLoggedIn) {
  if (isLoggedIn) {
    // ç™»å½•æ€ï¼šåªä½¿ç”¨å…¬å…±å®éªŒ
    const commonExperiments = filterCommonExperiments(abData);
    return hash(JSON.stringify(commonExperiments));
  } else {
    // æœªç™»å½•æ€ï¼šä½¿ç”¨æ‰€æœ‰å®éªŒ
    return hash(JSON.stringify(abData));
  }
}

// è¿‡æ»¤å…¬å…±å®éªŒ
function filterCommonExperiments(abData) {
  const commonExperiments = {};
  
  for (const [key, value] of Object.entries(abData)) {
    // æ£€æŸ¥å®éªŒçš„ tag
    if (value.tags && value.tags.includes('common')) {
      commonExperiments[key] = value;
    }
  }
  
  return commonExperiments;
}
```

**Redis å­˜å‚¨ç­–ç•¥**ï¼š

```javascript
// ç™»å½•æ€å­˜å‚¨
async function storeABDataForLoggedIn(abData, userId) {
  // ab-test-common-id: åªåŒ…å«å…¬å…±å®éªŒçš„ hash
  const commonExperiments = filterCommonExperiments(abData);
  const abTestCommonId = hash(JSON.stringify(commonExperiments));
  
  // Redis Key åŒ…å« userIdï¼Œé¿å…ä¸åŒç”¨æˆ·å†²çª
  const redisKey = `ab:${userId}:${abTestCommonId}`;
  
  // Value ä»ç„¶æ˜¯å®Œæ•´çš„ AB æ•°æ®
  await redis.setex(redisKey, 1800, JSON.stringify(abData));
  
  return abTestCommonId;
}
```

**æ•°æ®ç¤ºä¾‹**ï¼š

| å®éªŒ | ç”¨æˆ· ID | A (å…¬å…±) | B | AB æ•°æ® | ab-test-id | Redis Key |
|------|---------|---------|---|---------|-----------|-----------|
| ç”¨æˆ· 1 | xxxx1 | A1 | B1 | `{A:A1, B:B1}` | hash(A1) | `ab:xxxx1:hash(A1)` |
| ç”¨æˆ· 2 | xxxx2 | A1 | B2 | `{A:A1, B:B2}` | hash(A1) | `ab:xxxx2:hash(A1)` |

**å…³é”®ç‚¹**ï¼š
- âœ… ä¸¤ä¸ªç”¨æˆ·çš„ ab-test-id ç›¸åŒï¼ˆéƒ½æ˜¯ hash(A1)ï¼‰
- âœ… å¯ä»¥å…±äº«é¡µé¢ç¼“å­˜
- âœ… Redis Key ä¸åŒï¼ˆåŒ…å« userIdï¼‰ï¼Œé¿å…æ•°æ®å†²çª

**ç¼“å­˜ Key è®¡ç®—**ï¼š

```javascript
// ç™»å½•æ€ç¼“å­˜ Key
function getCacheKey(url, userId, orgId, abTestCommonId, isLoggedIn) {
  if (isLoggedIn) {
    return hash(url + userId + orgId + abTestCommonId);
  } else {
    return hash(url + abTestId);
  }
}
```

#### å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç”¨æˆ·è¯·æ±‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æ£€æŸ¥ç™»å½•æ€    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚
        â–¼                 â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æœªç™»å½•æ€  â”‚      â”‚ å·²ç™»å½•æ€  â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                 â”‚
        â–¼                 â–¼
  æ‰€æœ‰å®éªŒå‚ä¸      ä»…å…¬å…±å®éªŒå‚ä¸
  ab-test-id       ab-test-common-id
        â”‚                 â”‚
        â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  å­˜å…¥ Redis    â”‚
        â”‚                â”‚
        â”‚  Key:          â”‚
        â”‚  - æœªç™»å½•:     â”‚
        â”‚    ab:{id}     â”‚
        â”‚  - å·²ç™»å½•:     â”‚
        â”‚    ab:{userId}:â”‚
        â”‚    {commonId}  â”‚
        â”‚                â”‚
        â”‚  Value:        â”‚
        â”‚    å®Œæ•´ABæ•°æ®   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  è®¡ç®—ç¼“å­˜Key    â”‚
        â”‚                â”‚
        â”‚  - æœªç™»å½•:     â”‚
        â”‚    url + id    â”‚
        â”‚  - å·²ç™»å½•:     â”‚
        â”‚    url + uid + â”‚
        â”‚    commonId    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  SSR æ¸²æŸ“      â”‚
        â”‚                â”‚
        â”‚  ä» Redis è·å– â”‚
        â”‚  å®Œæ•´ABæ•°æ®     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  CSR ä½¿ç”¨      â”‚
        â”‚                â”‚
        â”‚  window.       â”‚
        â”‚  GD_AB_DATA    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### CSR æ•°æ®ä½¿ç”¨

```javascript
// å®¢æˆ·ç«¯ AB SDK
class ABClient {
  constructor() {
    this.init();
  }
  
  init() {
    // ä¼˜å…ˆä½¿ç”¨ SSR æ³¨å…¥çš„æ•°æ®
    if (window.GD_AB_DATA) {
      this.abData = window.GD_AB_DATA;
      this.syncToLocalStorage();
      return;
    }
    
    // æ£€æŸ¥ localStorage ç¼“å­˜
    const cachedData = this.getFromLocalStorage();
    if (cachedData && this.isValid(cachedData)) {
      this.abData = cachedData.data;
      return;
    }
    
    // é™çº§ï¼šé‡æ–°è·å–
    this.fetchABData();
  }
  
  syncToLocalStorage() {
    const abTestId = this.getCookie('x-ab-test-id');
    localStorage.setItem('ab-experiments', JSON.stringify({
      id: abTestId,
      data: this.abData,
      timestamp: Date.now()
    }));
  }
  
  isValid(cachedData) {
    // æ£€æŸ¥ ab-test-id æ˜¯å¦ä¸€è‡´
    const currentId = this.getCookie('x-ab-test-id');
    return cachedData.id === currentId;
  }
  
  // åŸ‹ç‚¹ä¸ŠæŠ¥ä½¿ç”¨å®Œæ•´æ•°æ®
  trackEvent(eventName, extra = {}) {
    track(eventName, {
      ...extra,
      ab_experiments: this.abData // å®Œæ•´çš„ AB æ•°æ®
    });
  }
  
  // æ¥å£è¯·æ±‚æºå¸¦ AB æ ‡è¯†
  async apiRequest(url, options = {}) {
    return fetch(url, {
      ...options,
      headers: {
        ...options.headers,
        'X-AB-Experiments': JSON.stringify(this.abData)
      }
    });
  }
}
```

**å…³é”®ç‚¹**ï¼š

1. âœ… **ç¼“å­˜ Key åªç”¨å…¬å…±å®éªŒ**
   - å¤§å¹…å‡å°‘ç¢ç‰‡åŒ–
   - æå‡å‘½ä¸­ç‡

2. âœ… **Redis å­˜å‚¨å®Œæ•´æ•°æ®**
   - CSR èƒ½è·å–æ‰€æœ‰å®éªŒ
   - åŸ‹ç‚¹å’Œæ¥å£æ­£å¸¸å·¥ä½œ

3. âœ… **ç”¨æˆ·éš”ç¦»**
   - Redis Key åŒ…å« userId
   - é¿å…æ•°æ®å†²çª

---

## ä¸‰ã€AB å¹³å°æ”¯æŒ

### 3.1 å®éªŒæ ‡ç­¾ç³»ç»Ÿ

ä¸ºäº†æ”¯æŒ"å…¬å…±å®éªŒ"çš„åŒºåˆ†ï¼Œéœ€è¦ AB å¹³å°æä¾›**å®éªŒæ ‡ç­¾**åŠŸèƒ½ã€‚

#### æ ‡ç­¾è®¾è®¡

**åœ¨åˆ›å»ºå®éªŒæ—¶è®¾ç½®æ ‡ç­¾**ï¼š

![AB å¹³å°æ ‡ç­¾è®¾ç½®](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-12_16-18-54.png)

**æ ‡ç­¾å‘½åè§„èŒƒ**ï¼š

```
ä½¿ç”¨ç®€å†™é¿å…æ•°æ®é‡è¿‡å¤§ï¼š
   s_ => sidebar_
   h_ => header_
   c_ => content_
   f_ => footer_
   e_ => editor_
   u_ => user_
```

#### æ ‡ç­¾åˆ—è¡¨

| æ ‡ç­¾å | æ ‡ç­¾å€¼ | æ ‡ç­¾å«ä¹‰ | æ˜¯å¦å…¬å…± | ç¤ºä¾‹æˆªå›¾ |
|--------|--------|---------|---------|---------|
| **ä¾§è¾¹èœå•æ ** | `s_menu` | ä¾§è¾¹æ èœå• | âœ… æ˜¯ | ![ä¾§è¾¹èœå•æ ](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-19_9-46-21.png) |
| **å¤´éƒ¨å¯¼èˆªæ ** | `h_nav` | é¡¶éƒ¨å¯¼èˆª | âœ… æ˜¯ | ![å¤´éƒ¨å¯¼èˆªæ ](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-19_9-45-55.png) |
| **é¦–é¡µå†…å®¹** | `c_home` | é¦–é¡µä¸»ä½“å†…å®¹ | âœ… æ˜¯ | ![é¦–é¡µå†…å®¹](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-19_9-53-17.png) |
| **æˆ‘çš„ç©ºé—´** | `c_dam` | æˆ‘çš„ç©ºé—´å†…å®¹ | âœ… æ˜¯ | ![æˆ‘çš„ç©ºé—´](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-19_9-54-17.png) |
| **æ¨¡æ¿é¡µå†…å®¹** | `c_temp` | æ¨¡æ¿åˆ—è¡¨é¡µ | âœ… æ˜¯ | ![æ¨¡æ¿é¡µå†…å®¹](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-19_9-55-26.png) |
| **ç´ æé¡µå†…å®¹** | `c_materials` | ç´ æåˆ—è¡¨é¡µ | âœ… æ˜¯ | ![ç´ æé¡µå†…å®¹](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-19_9-55-58.png) |
| **å›¢é˜Ÿç©ºé—´å†…å®¹** | `c_dam_team` | å›¢é˜Ÿç©ºé—´ | âœ… æ˜¯ | ![å›¢é˜Ÿç©ºé—´å†…å®¹](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-19_9-56-39.png) |
| **é¡µè„šå¯¼èˆª** | `f_nav` | é¡µè„š | âœ… æ˜¯ | ![é¡µè„šå¯¼èˆª](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-19_10-1-20.png) |
| **ç¼–è¾‘å™¨** | `e_design` | æ‰€æœ‰ç¼–è¾‘å™¨ | âš ï¸ ç‰¹æ®Š | ![ç¼–è¾‘å™¨](../RFC%2012.3ï¼šæé«˜ABç¼“å­˜å‘½ä¸­ç‡/attachments/image2025-3-19_9-58-27.png) |
| **ç™»å½•** | `u_login` | ç™»å½•æµç¨‹ | âš ï¸ ç‰¹æ®Š | - |

#### æ¥å£æ•°æ®æ ¼å¼

**AB æ¥å£è¿”å›çš„æ•°æ®ç»“æ„**ï¼š

```javascript
// GET /api/ab-experiments
{
  "experiments": {
    "sidebar_menu_redesign": {
      "variant": "b",
      "tags": ["s_menu", "common"]  // â† æ ‡ç­¾æ•°ç»„
    },
    "homepage_recommendation": {
      "variant": "a",
      "tags": ["c_home", "common"]
    },
    "template_list_style": {
      "variant": "b",
      "tags": ["c_temp"]  // â† éå…¬å…±å®éªŒï¼Œæ—  "common"
    }
  }
}
```

**æ ‡ç­¾è§„åˆ™**ï¼š

```
å…¬å…±å®éªŒæ ‡ç­¾åŒ…å« "common"
   â†“
ç”¨äºç”Ÿæˆ ab-test-common-id

éå…¬å…±å®éªŒæ ‡ç­¾ä¸åŒ…å« "common"
   â†“
ä¸å‚ä¸ ab-test-common-id è®¡ç®—
```

### 3.2 åˆ¤æ–­å…¬å…±å®éªŒ

```javascript
// è¿‡æ»¤å…¬å…±å®éªŒ
function filterCommonExperiments(experiments) {
  const commonExperiments = {};
  
  for (const [key, value] of Object.entries(experiments)) {
    // æ£€æŸ¥æ˜¯å¦æœ‰ "common" æ ‡ç­¾
    if (value.tags && value.tags.includes('common')) {
      commonExperiments[key] = value;
    }
  }
  
  return commonExperiments;
}

// ä½¿ç”¨ç¤ºä¾‹
const allExperiments = {
  "sidebar_menu_redesign": {
    "variant": "b",
    "tags": ["s_menu", "common"]
  },
  "template_list_style": {
    "variant": "a",
    "tags": ["c_temp"]
  }
};

const commonExperiments = filterCommonExperiments(allExperiments);
// â†’ { "sidebar_menu_redesign": { "variant": "b", "tags": [...] } }

const abTestCommonId = hash(JSON.stringify(commonExperiments));
```

---

## å››ã€æ–¹æ¡ˆå¯¹æ¯”

### 4.1 ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”

| ç»´åº¦ | æ–¹æ¡ˆä¸€ï¼šå®Œå…¨ç§»é™¤ | æ–¹æ¡ˆäºŒï¼šä»…å…¬å…±å®éªŒ | å½“å‰ï¼ˆæ‰€æœ‰å®éªŒï¼‰|
|------|----------------|-------------------|----------------|
| **ç¼“å­˜ç‰ˆæœ¬æ•°** | 10,000 | 10,000 Ã— 2 | 10,000 Ã— 8 |
| **ç¼“å­˜å‘½ä¸­ç‡** | ~80% | ~50% | ~10-15% |
| **å…¬å…±ç»„ä»¶ä¸€è‡´æ€§** | âŒ ä¸ä¸€è‡´ | âœ… ä¸€è‡´ | âœ… ä¸€è‡´ |
| **å®æ–½å¤æ‚åº¦** | ä½ | ä¸­ | - |
| **AB å¹³å°æ”¹é€ ** | æ—  | éœ€è¦æ ‡ç­¾ç³»ç»Ÿ | - |
| **æ¨èåº¦** | âŒ ä¸å¯è¡Œ | â­â­â­ æ¨è | - |

### 4.2 æ€§èƒ½æ”¶ç›Šé¢„ä¼°

**ç¼“å­˜å‘½ä¸­ç‡æå‡**ï¼š

| åœºæ™¯ | å½“å‰ | æ–¹æ¡ˆäºŒ | æå‡ |
|------|------|--------|------|
| **æœªç™»å½•æ€** | 60% | 60% | æ— å˜åŒ– |
| **å·²ç™»å½•æ€** | 10-15% | **40-50%** | â¬†ï¸ 3-4x |
| **æ•´ä½“** | 35% | **55%** | â¬†ï¸ 1.6x |

**æ€§èƒ½æŒ‡æ ‡æ”¹å–„**ï¼ˆé¢„ä¼°ï¼‰ï¼š

| æŒ‡æ ‡ | å½“å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|------|--------|------|
| **TTFB (P50)** | 1200 ms | **700 ms** | â¬‡ï¸ 42% |
| **TTFB (P95)** | 2500 ms | **1400 ms** | â¬‡ï¸ 44% |
| **LCP (P50)** | 2200 ms | **1600 ms** | â¬‡ï¸ 27% |
| **LCP (P95)** | 3500 ms | **2300 ms** | â¬‡ï¸ 34% |

**æˆæœ¬èŠ‚çœ**ï¼š

```
ç¼“å­˜å‘½ä¸­ç‡æå‡ â†’ SSR æ¸²æŸ“æ¬¡æ•°å‡å°‘ â†’ æœåŠ¡å™¨è´Ÿè½½é™ä½

å‡è®¾ï¼š
   - æ—¥å‡ PV: 1,000,000
   - æœªå‘½ä¸­æˆæœ¬: 200ms CPU æ—¶é—´
   - å‘½ä¸­ç‡æå‡: 35% â†’ 55% (+20%)

èŠ‚çœï¼š
   1,000,000 Ã— 20% Ã— 200ms = 40,000 ç§’ CPU æ—¶é—´/å¤©
   â‰ˆ 11 å°æ—¶ CPU æ—¶é—´/å¤©
   â‰ˆ 30% æœåŠ¡å™¨èµ„æº
```

---

## äº”ã€å®æ–½æ–¹æ¡ˆ

### 5.1 åˆ†é˜¶æ®µå®æ–½

**é˜¶æ®µ 1ï¼šAB å¹³å°æ”¹é€ **

```
ä»»åŠ¡ï¼š
1. âœ… æ·»åŠ å®éªŒæ ‡ç­¾å­—æ®µ
2. âœ… å®éªŒåˆ›å»ºé¡µé¢å¢åŠ æ ‡ç­¾é€‰æ‹©
3. âœ… AB æ¥å£è¿”å›æ ‡ç­¾ä¿¡æ¯

è´Ÿè´£ï¼šæ•°æ®å›¢é˜Ÿ @å†·æœˆ
æ—¶é—´ï¼š1 å‘¨
```

**é˜¶æ®µ 2ï¼šWorker å±‚æ”¹é€ **

```
ä»»åŠ¡ï¼š
1. âœ… åŒºåˆ†ç™»å½•æ€å’Œæœªç™»å½•æ€
2. âœ… ç™»å½•æ€è¿‡æ»¤å…¬å…±å®éªŒ
3. âœ… ç”Ÿæˆ ab-test-common-id
4. âœ… Redis å­˜å‚¨ç­–ç•¥è°ƒæ•´

è´Ÿè´£ï¼šåŸºå»ºå›¢é˜Ÿ
æ—¶é—´ï¼š1 å‘¨
```

**é˜¶æ®µ 3ï¼šBFF/SSR æ”¹é€ **

```
ä»»åŠ¡ï¼š
1. âœ… ç¼“å­˜ Key è®¡ç®—é€»è¾‘è°ƒæ•´
2. âœ… Redis è¯»å–é€»è¾‘è°ƒæ•´
3. âœ… ç›‘æ§åŸ‹ç‚¹æ·»åŠ 

è´Ÿè´£ï¼šåŸºå»ºå›¢é˜Ÿ
æ—¶é—´ï¼š1 å‘¨
```

**é˜¶æ®µ 4ï¼šCSR é€‚é…**

```
ä»»åŠ¡ï¼š
1. âœ… å®¢æˆ·ç«¯ SDK é€‚é…
2. âœ… localStorage ç¼“å­˜é€»è¾‘
3. âœ… åŸ‹ç‚¹å’Œæ¥å£è°ƒç”¨é€‚é…

è´Ÿè´£ï¼šåŸºå»ºå›¢é˜Ÿ
æ—¶é—´ï¼š1 å‘¨
```

**é˜¶æ®µ 5ï¼šç°åº¦éªŒè¯**

```
ä»»åŠ¡ï¼š
1. âœ… å°æµé‡éªŒè¯ï¼ˆ5%ï¼‰
2. âœ… ç›‘æ§æ•°æ®è§‚å¯Ÿ
3. âœ… é—®é¢˜ä¿®å¤
4. âœ… é€æ­¥æ”¾é‡

è´Ÿè´£ï¼šåŸºå»º + ä¸šåŠ¡å›¢é˜Ÿ
æ—¶é—´ï¼š2 å‘¨
```

### 5.2 é™çº§æ–¹æ¡ˆ

```javascript
// é…ç½®å¼€å…³
const CONFIG = {
  useCommonExperimentsOnly: true,  // ä¸»å¼€å…³
  fallbackToAllExperiments: true   // é™çº§å¼€å…³
};

// Worker å±‚é™çº§
async function generateABTestId(abData, isLoggedIn) {
  if (!CONFIG.useCommonExperimentsOnly) {
    // é™çº§ï¼šä½¿ç”¨æ‰€æœ‰å®éªŒï¼ˆæ—§é€»è¾‘ï¼‰
    return hash(JSON.stringify(abData));
  }
  
  try {
    if (isLoggedIn) {
      const commonExperiments = filterCommonExperiments(abData);
      
      if (Object.keys(commonExperiments).length === 0) {
        // æ²¡æœ‰å…¬å…±å®éªŒï¼Œé™çº§
        console.warn('No common experiments found, fallback');
        if (CONFIG.fallbackToAllExperiments) {
          return hash(JSON.stringify(abData));
        }
      }
      
      return hash(JSON.stringify(commonExperiments));
    } else {
      return hash(JSON.stringify(abData));
    }
  } catch (error) {
    console.error('Generate AB test ID failed, fallback', error);
    return hash(JSON.stringify(abData));
  }
}
```

### 5.3 ç›‘æ§æŒ‡æ ‡

**æ ¸å¿ƒæŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | è¯´æ˜ | ç›®æ ‡ | å‘Šè­¦é˜ˆå€¼ |
|------|------|------|---------|
| **ç¼“å­˜å‘½ä¸­ç‡ï¼ˆæœªç™»å½•ï¼‰** | æœªç™»å½•ç”¨æˆ·ç¼“å­˜å‘½ä¸­ç‡ | â‰¥ 60% | < 50% |
| **ç¼“å­˜å‘½ä¸­ç‡ï¼ˆå·²ç™»å½•ï¼‰** | å·²ç™»å½•ç”¨æˆ·ç¼“å­˜å‘½ä¸­ç‡ | â‰¥ 45% | < 30% |
| **ç¼“å­˜å‘½ä¸­ç‡ï¼ˆæ•´ä½“ï¼‰** | æ•´ä½“ç¼“å­˜å‘½ä¸­ç‡ | â‰¥ 55% | < 45% |
| **TTFB (P50)** | é¦–å­—èŠ‚æ—¶é—´ä¸­ä½æ•° | â‰¤ 700 ms | > 900 ms |
| **LCP (P50)** | æœ€å¤§å†…å®¹ç»˜åˆ¶ä¸­ä½æ•° | â‰¤ 1600 ms | > 2000 ms |
| **å…¬å…±å®éªŒæ¯”ä¾‹** | æ ‡è®°ä¸º common çš„å®éªŒå æ¯” | 20-30% | > 50% |
| **ab-test-id é•¿åº¦** | ab-test-id å­—ç¬¦ä¸²é•¿åº¦ | < 64 | > 128 |

**ç›‘æ§é¢æ¿**ï¼š

```
AB ç¼“å­˜ä¼˜åŒ–ç›‘æ§

1. ç¼“å­˜å‘½ä¸­ç‡
   â”œâ”€ æœªç™»å½•: 62% (ç›®æ ‡ â‰¥60%) âœ…
   â”œâ”€ å·²ç™»å½•: 47% (ç›®æ ‡ â‰¥45%) âœ…
   â””â”€ æ•´ä½“: 57% (ç›®æ ‡ â‰¥55%) âœ…

2. æ€§èƒ½æŒ‡æ ‡
   â”œâ”€ TTFB P50: 680ms (ç›®æ ‡ â‰¤700ms) âœ…
   â”œâ”€ TTFB P95: 1350ms
   â”œâ”€ LCP P50: 1580ms (ç›®æ ‡ â‰¤1600ms) âœ…
   â””â”€ LCP P95: 2250ms

3. AB å®éªŒç»Ÿè®¡
   â”œâ”€ æ€»å®éªŒæ•°: 12
   â”œâ”€ å…¬å…±å®éªŒæ•°: 3 (25%)
   â”œâ”€ ç¼“å­˜ç¢ç‰‡åŒ–: 2^3 = 8 ç‰ˆæœ¬
   â””â”€ å¦‚æœæ‰€æœ‰å®éªŒ: 2^12 = 4096 ç‰ˆæœ¬

4. å¼‚å¸¸ç›‘æ§
   â”œâ”€ å…¬å…±ç»„ä»¶ä¸ä¸€è‡´: 0 æ¬¡
   â”œâ”€ ab-test-id ç”Ÿæˆå¤±è´¥: 0 æ¬¡
   â””â”€ Redis è¯»å–å¤±è´¥: 2 æ¬¡ (0.01%)
```

---

## å…­ã€æ€»ç»“

### 6.1 æ ¸å¿ƒä»·å€¼

**é—®é¢˜è§£å†³**ï¼š

1. âœ… **ç¼“å­˜ç¢ç‰‡åŒ–**
   - ä» 2^n é™åˆ° 2^m (m << n)
   - ç™»å½•æ€ç¼“å­˜å‘½ä¸­ç‡æå‡ 3-4 å€

2. âœ… **æ€§èƒ½æ”¹å–„**
   - TTFB é™ä½ 40%+
   - LCP é™ä½ 30%+
   - å›åˆ°ä¼˜ç§€æ°´å¹³ï¼ˆ< 1.5sï¼‰

3. âœ… **æˆæœ¬èŠ‚çœ**
   - SSR æ¸²æŸ“æ¬¡æ•°å‡å°‘ 20%
   - æœåŠ¡å™¨èµ„æºèŠ‚çœ 30%

4. âœ… **ä½“éªŒæå‡**
   - é¡µé¢åŠ è½½æ›´å¿«
   - å…¬å…±ç»„ä»¶ä¿æŒä¸€è‡´

### 6.2 å…³é”®è¦ç‚¹

**æŠ€æœ¯è¦ç‚¹**ï¼š

1. âœ… **åŒºåˆ†å…¬å…±å®éªŒå’Œç§æœ‰å®éªŒ**
   - å…¬å…±å®éªŒï¼šSSR æ¸²æŸ“çš„å…±äº«ç»„ä»¶
   - ç§æœ‰å®éªŒï¼šé¡µé¢ç‰¹å®šæˆ– CSR ç»„ä»¶

2. âœ… **ç™»å½•æ€å’Œæœªç™»å½•æ€åˆ†åˆ«å¤„ç†**
   - æœªç™»å½•ï¼šæ‰€æœ‰å®éªŒå‚ä¸ï¼ˆç”¨æˆ·å¯å…±äº«ç¼“å­˜ï¼‰
   - å·²ç™»å½•ï¼šä»…å…¬å…±å®éªŒå‚ä¸ï¼ˆå‡å°‘ç¢ç‰‡åŒ–ï¼‰

3. âœ… **å®Œæ•´æ•°æ®å­˜å‚¨**
   - Redis å­˜å‚¨å®Œæ•´ AB æ•°æ®
   - CSR å¯è·å–æ‰€æœ‰å®éªŒä¿¡æ¯
   - åŸ‹ç‚¹å’Œæ¥å£æ­£å¸¸å·¥ä½œ

4. âœ… **ç”¨æˆ·éš”ç¦»**
   - Redis Key åŒ…å« userId
   - é¿å…ä¸åŒç”¨æˆ·æ•°æ®å†²çª

### 6.3 æœ€ä½³å®è·µå»ºè®®

**å®éªŒè®¾è®¡**ï¼š

1. â­ **æ§åˆ¶å…¬å…±å®éªŒæ•°é‡**
   - å»ºè®®ï¼šâ‰¤ 3 ä¸ªåŒæ—¶è¿›è¡Œ
   - é¿å…è¿‡åº¦ç¢ç‰‡åŒ–

2. â­ **ä¼˜å…ˆä½¿ç”¨ç§æœ‰å®éªŒ**
   - é¡µé¢ç‰¹å®šåŠŸèƒ½ç”¨ç§æœ‰å®éªŒ
   - ä¸å½±å“ç¼“å­˜

3. â­ **å®éªŒç”Ÿå‘½å‘¨æœŸç®¡ç†**
   - åŠæ—¶ä¸‹çº¿å®Œæˆçš„å®éªŒ
   - é¿å…é•¿æœŸå ç”¨

**ç›‘æ§å’Œè¿ç»´**ï¼š

1. âœ… å®æ—¶ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡
2. âœ… å®šæœŸå®¡æŸ¥å…¬å…±å®éªŒåˆ—è¡¨
3. âœ… è¯„ä¼°å®éªŒå¯¹ç¼“å­˜çš„å½±å“

---

**æ–‡æ¡£ç»´æŠ¤**ï¼šå‰ç«¯åŸºå»ºå›¢é˜Ÿ  
**RFC ä½œè€…**ï¼šå‰ç«¯æ¶æ„ç»„  
**æ•°æ®æ”¯æŒ**ï¼š@å†·æœˆ  
**æ•´ç†æ—¥æœŸ**ï¼š2025-01-25  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
