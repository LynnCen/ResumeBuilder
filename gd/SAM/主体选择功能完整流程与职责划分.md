# ä¸»ä½“é€‰æ‹©åŠŸèƒ½ï¼šå®Œæ•´æµç¨‹ä¸èŒè´£åˆ’åˆ†è¯¦è§£

## ğŸ“‹ ç›®å½•

1. [æµç¨‹çº æ­£ä¸è¡¥å……](#ä¸€æµç¨‹çº æ­£ä¸è¡¥å……)
2. [èŒè´£åˆ’åˆ†ï¼šlego/sam vs é¡¹ç›®å®ç°](#äºŒèŒè´£åˆ’åˆ†legosam-vs-é¡¹ç›®å®ç°)
3. [Layeré«˜äº®å®ç°åŸç†](#ä¸‰layeré«˜äº®å®ç°åŸç†)

---

## ä¸€ã€æµç¨‹çº æ­£ä¸è¡¥å……

### 1.1 æ‚¨ç†è§£çš„æµç¨‹ï¼ˆéƒ¨åˆ†æ­£ç¡®ï¼‰

æ‚¨æåˆ°çš„æ­¥éª¤ï¼š

1. âœ… è·å–åˆ°å›¾ç‰‡ä¿¡æ¯
2. âœ… è°ƒç”¨åç«¯æ¥å£è·å–åˆ°SAMå¤„ç†åçš„åˆ†åŒºç‰¹å¾ä¿¡æ¯
3. âœ… é¼ æ ‡hoveråˆ°å›¾ç‰‡ä¹‹åï¼Œè¿›è¡Œåæ ‡è½¬æ¢
4. âœ… åˆ¤æ–­å½“å‰hoverä½ç½®å±äºå“ªä¸€éƒ¨åˆ†åˆ†åŒºï¼Œå¹¶è¿”å›å¯¹åº”åˆ†åŒºçš„layer
5. âœ… å°†å¯¹åº”åˆ†åŒºçš„layeré«˜äº®

**è¯„ä»·ï¼š** æ•´ä½“æ€è·¯æ­£ç¡®ï¼Œä½†ç¼ºå°‘ä¸€äº›å…³é”®æ­¥éª¤å’Œç»†èŠ‚ã€‚

### 1.2 å®Œæ•´æµç¨‹ï¼ˆçº æ­£ä¸è¡¥å……ï¼‰

#### **é˜¶æ®µä¸€ï¼šåˆå§‹åŒ–å‡†å¤‡**

```
æ­¥éª¤1ï¼šç”¨æˆ·é€‰æ‹©"ä¸»ä½“é€‰æ‹©"å·¥å…·
  â†“
æ­¥éª¤2ï¼šè·å–å›¾ç‰‡URLå’Œå°ºå¯¸ä¿¡æ¯
  â†“
æ­¥éª¤3ï¼šæ£€æŸ¥ç¼“å­˜ï¼ˆjsonMapï¼‰
  - å¦‚æœå·²ç¼“å­˜ï¼Œç›´æ¥ä½¿ç”¨
  - å¦‚æœæœªç¼“å­˜ï¼Œç»§ç»­ä¸‹ä¸€æ­¥
  â†“
æ­¥éª¤4ï¼šè°ƒç”¨åç«¯APIè·å–SAMåˆ†åŒºæ•°æ®
  - API: factory.apiService.autoMasks(imageUrl)
  - è¿”å›: IAutoMask[] æ•°ç»„ï¼ˆå¤šä¸ªå€™é€‰åˆ†åŒºï¼‰
  â†“
æ­¥éª¤5ï¼šåˆ›å»ºAutoMaskModelå®ä¾‹
  - factory.createAutoMaskModel(imageUrl, maskData)
  - å†…éƒ¨ä¼šä¸ºæ¯ä¸ªmaskåˆ›å»ºAutoMaskLayerå¯¹è±¡
  - æ¯ä¸ªLayeråŒ…å«ï¼šidã€maskCanvasã€areaç­‰
```

**å…³é”®ä»£ç ï¼š**

```typescript
// use-auto-masks.ts (72-96è¡Œ)
const _getAutoMasks = async (_url: string) => {
  const res: IAutoMask[] = await initFactory().then((factory) =>
    factory.apiService.autoMasks(
      ossUrl(_url, {
        width: 3000,
        height: 3000,
        useDpr: false,
        forcePngResize: true,
      }),
    ),
  );
  return res;
};

promise = getAutoMasks.then((data: IAutoMask[]) => {
  return initFactory().then(
    (factory) => factory.createAutoMaskModel(url, data), // åˆ›å»ºæ¨¡å‹
  );
});
```

#### **é˜¶æ®µäºŒï¼šäº¤äº’å¤„ç†ï¼ˆæ‚¨æåˆ°çš„éƒ¨åˆ†ï¼‰**

```
æ­¥éª¤6ï¼šé¼ æ ‡hoveräº‹ä»¶è§¦å‘
  â†“
æ­¥éª¤7ï¼šåæ ‡è½¬æ¢ï¼ˆå±å¹•åæ ‡ â†’ å›¾åƒåæ ‡ï¼‰
  - è€ƒè™‘canvasç¼©æ”¾ã€åç§»ã€pixelRatio
  - è½¬æ¢åˆ°åŸå§‹å›¾åƒå°ºå¯¸
  â†“
æ­¥éª¤8ï¼šè°ƒç”¨pickLayer(x, y)æŸ¥æ‰¾layer
  - éå†æ‰€æœ‰AutoMaskLayer
  - æ£€æŸ¥åæ ‡æ˜¯å¦åœ¨layerçš„maskåŒºåŸŸå†…
  - è¿”å›æœ€ä¸Šå±‚çš„layerï¼ˆæ”¯æŒé‡å ï¼‰
  â†“
æ­¥éª¤9ï¼šé«˜äº®æ˜¾ç¤ºlayer
  - æ¸…ç©ºselectionCanvas
  - åœ¨layer.maskCanvaså‘¨å›´ç»˜åˆ¶è¾¹æ¡†
  - ä½¿ç”¨å†…é˜´å½±æŠ€æœ¯å®ç°é«˜äº®æ•ˆæœ
```

**å…³é”®ä»£ç ï¼š**

```typescript
// use-auto-masks.ts (117-141è¡Œ)
function handleHoverMask(e: MouseEvent) {
  const autoMaskModel = getAutoMaskModel();
  if (!enabled.value || !autoMaskModel) return;

  // æ­¥éª¤7ï¼šåæ ‡è½¬æ¢
  const { x, y } = pointFormEvent(e, {
    width: autoMaskModel.getSourceImage().naturalWidth,
    height: autoMaskModel.getSourceImage().naturalHeight,
  });

  // æ­¥éª¤8ï¼šæŸ¥æ‰¾layerï¼ˆlego/samæä¾›ï¼‰
  const layer = autoMaskModel.pickLayer(x, y);

  // æ­¥éª¤9ï¼šé«˜äº®æ˜¾ç¤ºï¼ˆé¡¹ç›®å®ç°ï¼‰
  const ctx = hoverCanvasRef.value?.getContext('2d');
  ctx?.clearRect(0, 0, hoverCanvasRef.value!.width, hoverCanvasRef.value!.height);

  if (ctx && layer) {
    addBorderToCanvas(layer.maskCanvas, hoverCanvasRef.value!, {
      borderWidth:
        Math.max(1, (2 * layer.maskCanvas.width) / hoverCanvasRef.value!.width) * pixelRatio.value,
      borderColor: AUTO_MASK_HOVER_BORDER_COLOR, // é’è‰² #33C8E6
    });
  }
}
```

#### **é˜¶æ®µä¸‰ï¼šç‚¹å‡»ç¡®è®¤ï¼ˆæ‚¨é—æ¼çš„éƒ¨åˆ†ï¼‰**

```
æ­¥éª¤10ï¼šç”¨æˆ·ç‚¹å‡»layer
  â†“
æ­¥éª¤11ï¼šåˆ‡æ¢layeré€‰ä¸­çŠ¶æ€
  - toggleLayerMode(x, y)
  - å¦‚æœå·²é€‰ä¸­ï¼Œåˆ™å–æ¶ˆé€‰ä¸­
  - å¦‚æœæœªé€‰ä¸­ï¼Œåˆ™æ·»åŠ åˆ°é€‰ä¸­åˆ—è¡¨
  â†“
æ­¥éª¤12ï¼šåˆå¹¶æ‰€æœ‰é€‰ä¸­çš„layer
  - getMaskResult()
  - å°†æ‰€æœ‰é€‰ä¸­layerçš„maskCanvasåˆå¹¶
  - ç”Ÿæˆæœ€ç»ˆçš„maskç»“æœ
  â†“
æ­¥éª¤13ï¼šæ›´æ–°maskCanvas
  - è°ƒç”¨maskResultChangeå›è°ƒ
  - å°†åˆå¹¶åçš„maskç»˜åˆ¶åˆ°maskCanvas
  - é€šçŸ¥çˆ¶ç»„ä»¶æ›´æ–°UI
```

**å…³é”®ä»£ç ï¼š**

```typescript
// use-auto-masks.ts (143-156è¡Œ)
function handlePickMask(e: MouseEvent) {
  const autoMaskModel = getAutoMaskModel();
  if (!enabled.value || !autoMaskModel) return;

  const { x, y } = pointFormEvent(e, {
    width: autoMaskModel.getSourceImage().naturalWidth,
    height: autoMaskModel.getSourceImage().naturalHeight,
  });

  // æ­¥éª¤11ï¼šåˆ‡æ¢é€‰ä¸­çŠ¶æ€ï¼ˆlego/samæä¾›ï¼‰
  autoMaskModel.toggleLayerMode(x, y);

  // æ­¥éª¤12ï¼šè·å–åˆå¹¶åçš„maskï¼ˆlego/samæä¾›ï¼‰
  const maskResult = autoMaskModel.getMaskResult();

  // æ­¥éª¤13ï¼šæ›´æ–°maskCanvasï¼ˆé¡¹ç›®å®ç°ï¼‰
  options.maskResultChange?.(maskResult?.getMask(AUTO_MASK_COLOR) || null, getSnapshot());

  // ç»§ç»­æ˜¾ç¤ºé«˜äº®
  handleHoverMask(e);
}
```

### 1.3 æµç¨‹å¯¹æ¯”æ€»ç»“

| æ‚¨çš„ç†è§£               | å®Œæ•´æµç¨‹     | è¯´æ˜                         |
| ---------------------- | ------------ | ---------------------------- |
| âœ… è·å–å›¾ç‰‡ä¿¡æ¯        | âœ… æ­¥éª¤1-2   | æ­£ç¡®                         |
| âœ… è°ƒç”¨åç«¯è·å–åˆ†åŒº    | âœ… æ­¥éª¤4     | æ­£ç¡®ï¼Œä½†éœ€è¦å…ˆæ£€æŸ¥ç¼“å­˜       |
| âœ… åæ ‡è½¬æ¢            | âœ… æ­¥éª¤7     | æ­£ç¡®                         |
| âœ… åˆ¤æ–­åˆ†åŒºå¹¶è¿”å›layer | âœ… æ­¥éª¤8     | æ­£ç¡®ï¼Œä½†ç”±lego/samå®ç°       |
| âœ… é«˜äº®layer           | âœ… æ­¥éª¤9     | æ­£ç¡®ï¼Œä½†å®ç°æ–¹å¼éœ€è¦è¯¦ç»†è¯´æ˜ |
| âŒ ç¼ºå¤±                | âœ… æ­¥éª¤10-13 | **ç‚¹å‡»ç¡®è®¤å’Œmaskåˆå¹¶æµç¨‹**   |

---

## äºŒã€èŒè´£åˆ’åˆ†ï¼šlego/sam vs é¡¹ç›®å®ç°

### 2.1 lego/sam çš„èŒè´£ï¼ˆåº•å±‚èƒ½åŠ›ï¼‰

**lego/sam** æ˜¯ä¸€ä¸ªå°è£…å¥½çš„SAMæ¨¡å‹åº“ï¼Œæä¾›ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›ï¼š

#### **1. æ•°æ®æ¨¡å‹ç®¡ç†**

```typescript
// lego/sam æä¾›
class AutoMaskModel {
  private autoMaskLayers: AutoMaskLayer[]; // ç®¡ç†æ‰€æœ‰layer
  private layerMap: Map<string, AutoMaskLayer>; // å¿«é€ŸæŸ¥æ‰¾

  constructor(autoMasks: IAutoMask[], image: HTMLImageElement) {
    // å°†åç«¯è¿”å›çš„IAutoMask[]è½¬æ¢ä¸ºAutoMaskLayer[]
    // æ¯ä¸ªlayeråŒ…å«ï¼š
    // - id: å”¯ä¸€æ ‡è¯†
    // - maskCanvas: è¯¥åˆ†åŒºçš„maskå›¾åƒï¼ˆCanvasï¼‰
    // - area: é¢ç§¯
    // - mode: é€‰ä¸­çŠ¶æ€ï¼ˆnull | 'source-over' | 'destination-out'ï¼‰
  }
}
```

**æ•°æ®ç»“æ„ï¼š**

```typescript
interface AutoMaskLayer {
  id: string; // å”¯ä¸€ID
  color: [number, number, number, number]; // RGBAé¢œè‰²
  mode: null | 'source-over' | 'destination-out'; // é€‰ä¸­çŠ¶æ€
  area: number; // é¢ç§¯
  maskCanvas: HTMLCanvasElement; // è¯¥åˆ†åŒºçš„maskå›¾åƒ
  segmentation: {
    counts: number[]; // RLEç¼–ç æ•°æ®
    size: number[]; // å°ºå¯¸
  };
}
```

#### **2. åæ ‡æ‹¾å–ï¼ˆæ ¸å¿ƒç®—æ³•ï¼‰**

```typescript
// lego/sam æä¾›
pickLayer(x: number, y: number): AutoMaskLayer | null {
    // å®ç°é€»è¾‘ï¼ˆä¼ªä»£ç ï¼‰ï¼š
    // 1. éå†æ‰€æœ‰layerï¼ˆä»åå¾€å‰ï¼Œå¤„ç†é‡å ï¼‰
    // 2. æ£€æŸ¥åæ ‡(x, y)æ˜¯å¦åœ¨layer.maskCanvasçš„éé€æ˜åŒºåŸŸå†…
    // 3. ä½¿ç”¨Canvasçš„isPointInPathæˆ–åƒç´ æ£€æµ‹
    // 4. è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„layerï¼ˆæœ€ä¸Šå±‚ï¼‰
    // 5. å¦‚æœéƒ½ä¸åŒ¹é…ï¼Œè¿”å›null
}
```

**æŠ€æœ¯ç»†èŠ‚ï¼š**

- ä½¿ç”¨RLEï¼ˆRun-Length Encodingï¼‰å‹ç¼©çš„segmentationæ•°æ®
- å¿«é€Ÿåˆ¤æ–­ç‚¹æ˜¯å¦åœ¨maskåŒºåŸŸå†…
- æ”¯æŒå¤šä¸ªlayeré‡å çš„æƒ…å†µ

#### **3. é€‰ä¸­çŠ¶æ€ç®¡ç†**

```typescript
// lego/sam æä¾›
toggleLayerMode(x: number, y: number): AutoMaskResult | null {
    // 1. è°ƒç”¨pickLayeræ‰¾åˆ°å¯¹åº”çš„layer
    // 2. åˆ‡æ¢layer.modeçŠ¶æ€ï¼š
    //    - null â†’ 'source-over' (é€‰ä¸­)
    //    - 'source-over' â†’ null (å–æ¶ˆé€‰ä¸­)
    // 3. è¿”å›åˆå¹¶åçš„maskç»“æœ
}

getMaskResult(): AutoMaskResult | null {
    // åˆå¹¶æ‰€æœ‰mode === 'source-over'çš„layer
    // è¿”å›æœ€ç»ˆçš„mask Canvas
}
```

#### **4. å¿«ç…§ç®¡ç†ï¼ˆæ’¤é”€/é‡åšï¼‰**

```typescript
// lego/sam æä¾›
getSimpleAutoMasks(): Pick<AutoMaskLayer, 'mode' | 'id'>[] {
    // è¿”å›å½“å‰æ‰€æœ‰layerçš„é€‰ä¸­çŠ¶æ€
    // ç”¨äºä¿å­˜å¿«ç…§
}

setSimpleAutoMasks(autoMasks: Pick<AutoMaskLayer, 'mode' | 'id'>[]): void {
    // æ¢å¤layerçš„é€‰ä¸­çŠ¶æ€
    // ç”¨äºæ’¤é”€/é‡åš
}
```

### 2.2 é¡¹ç›®å®ç°çš„èŒè´£ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰

**é¡¹ç›®ä»£ç **è´Ÿè´£ä»¥ä¸‹ä¸šåŠ¡é€»è¾‘ï¼š

#### **1. APIè°ƒç”¨ä¸æ•°æ®è·å–**

```typescript
// use-auto-masks.ts (é¡¹ç›®å®ç°)
const _getAutoMasks = async (_url: string) => {
  // 1. å›¾ç‰‡é¢„å¤„ç†ï¼ˆå‹ç¼©ã€æ ¼å¼è½¬æ¢ï¼‰
  const processedUrl = ossUrl(_url, {
    width: 3000,
    height: 3000,
    useDpr: false,
    forcePngResize: true,
  });

  // 2. è°ƒç”¨åç«¯API
  const res: IAutoMask[] = await factory.apiService.autoMasks(processedUrl);

  // 3. ç¼“å­˜ç»“æœ
  jsonMap.set(_url, res);

  return res;
};
```

**èŒè´£ï¼š**

- å›¾ç‰‡é¢„å¤„ç†ï¼ˆå°ºå¯¸é™åˆ¶ã€æ ¼å¼è½¬æ¢ï¼‰
- è°ƒç”¨åç«¯API
- ç»“æœç¼“å­˜ï¼ˆé¿å…é‡å¤è¯·æ±‚ï¼‰
- é”™è¯¯å¤„ç†

#### **2. åæ ‡è½¬æ¢**

```typescript
// use-auto-masks.ts (é¡¹ç›®å®ç°)
const { x, y } = pointFormEvent(e, {
  width: autoMaskModel.getSourceImage().naturalWidth,
  height: autoMaskModel.getSourceImage().naturalHeight,
});
```

**èŒè´£ï¼š**

- å±å¹•åæ ‡ â†’ å›¾åƒåæ ‡
- è€ƒè™‘canvasç¼©æ”¾ã€åç§»ã€pixelRatio
- å¤„ç†ä¸åŒè®¾å¤‡çš„DPIå·®å¼‚

#### **3. äº‹ä»¶å¤„ç†ä¸UIäº¤äº’**

```typescript
// use-auto-masks.ts (é¡¹ç›®å®ç°)
useEventListener(hoverCanvasRef, 'mousemove', handleHoverMask);
useEventListener(hoverCanvasRef, 'mouseleave', handleMouseLeave);
useEventListener(hoverCanvasRef, 'click', handlePickMask);
```

**èŒè´£ï¼š**

- ç»‘å®šé¼ æ ‡äº‹ä»¶
- å¤„ç†hoverã€clickã€leaveç­‰äº¤äº’
- æ§åˆ¶loadingçŠ¶æ€
- ç®¡ç†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ

#### **4. Layeré«˜äº®æ¸²æŸ“**

```typescript
// use-auto-masks.ts (é¡¹ç›®å®ç°)
if (ctx && layer) {
  addBorderToCanvas(layer.maskCanvas, hoverCanvasRef.value!, {
    borderWidth: calculatedWidth,
    borderColor: AUTO_MASK_HOVER_BORDER_COLOR,
  });
}
```

**èŒè´£ï¼š**

- åœ¨selectionCanvasä¸Šç»˜åˆ¶é«˜äº®æ•ˆæœ
- ä½¿ç”¨å†…é˜´å½±æŠ€æœ¯å®ç°è¾¹æ¡†
- å“åº”å¼è¾¹æ¡†å®½åº¦è®¡ç®—

#### **5. Maskç»“æœå¤„ç†**

```typescript
// use-auto-masks.ts (é¡¹ç›®å®ç°)
options.maskResultChange?.(maskResult?.getMask(AUTO_MASK_COLOR) || null, getSnapshot());
```

**èŒè´£ï¼š**

- å°†lego/samè¿”å›çš„maskç»“æœä¼ é€’ç»™çˆ¶ç»„ä»¶
- æ›´æ–°maskCanvas
- ä¿å­˜å¿«ç…§ç”¨äºæ’¤é”€/é‡åš

### 2.3 èŒè´£åˆ’åˆ†æ€»ç»“è¡¨

| åŠŸèƒ½         | lego/sam                        | é¡¹ç›®å®ç°                              | è¯´æ˜                      |
| ------------ | ------------------------------- | ------------------------------------- | ------------------------- |
| **æ•°æ®æ¨¡å‹** | âœ… AutoMaskModelã€AutoMaskLayer | âŒ                                    | lego/samç®¡ç†æ‰€æœ‰layeræ•°æ® |
| **åæ ‡æ‹¾å–** | âœ… pickLayer(x, y)              | âŒ                                    | lego/samå®ç°æ ¸å¿ƒç®—æ³•      |
| **é€‰ä¸­ç®¡ç†** | âœ… toggleLayerMode()            | âŒ                                    | lego/samç®¡ç†é€‰ä¸­çŠ¶æ€      |
| **Maskåˆå¹¶** | âœ… getMaskResult()              | âŒ                                    | lego/samåˆå¹¶é€‰ä¸­çš„layer   |
| **APIè°ƒç”¨**  | âŒ                              | âœ… è°ƒç”¨factory.apiService.autoMasks() | é¡¹ç›®è´Ÿè´£ç½‘ç»œè¯·æ±‚          |
| **åæ ‡è½¬æ¢** | âŒ                              | âœ… pointFormEvent()                   | é¡¹ç›®è´Ÿè´£åæ ‡ç³»ç»Ÿè½¬æ¢      |
| **äº‹ä»¶å¤„ç†** | âŒ                              | âœ… useEventListener                   | é¡¹ç›®è´Ÿè´£UIäº¤äº’            |
| **é«˜äº®æ¸²æŸ“** | âŒ                              | âœ… addBorderToCanvas()                | é¡¹ç›®è´Ÿè´£è§†è§‰æ•ˆæœ          |
| **ç¼“å­˜ç®¡ç†** | âŒ                              | âœ… jsonMap                            | é¡¹ç›®è´Ÿè´£æ€§èƒ½ä¼˜åŒ–          |
| **ç”Ÿå‘½å‘¨æœŸ** | âŒ                              | âœ… watchã€onMounted                   | é¡¹ç›®è´Ÿè´£ç»„ä»¶ç®¡ç†          |

**æ ¸å¿ƒåŸåˆ™ï¼š**

- **lego/sam**ï¼šæä¾›åº•å±‚ç®—æ³•å’Œæ•°æ®æ¨¡å‹ï¼ˆ"åšä»€ä¹ˆ"ï¼‰
- **é¡¹ç›®å®ç°**ï¼šæä¾›ä¸šåŠ¡é€»è¾‘å’ŒUIäº¤äº’ï¼ˆ"æ€ä¹ˆåš"ï¼‰

---

## ä¸‰ã€Layeré«˜äº®å®ç°åŸç†

### 3.1 é«˜äº®éœ€æ±‚åˆ†æ

**éœ€æ±‚ï¼š**

- å½“é¼ æ ‡æ‚¬åœåœ¨æŸä¸ªlayerä¸Šæ—¶ï¼Œæ˜¾ç¤ºè¯¥layerçš„è¾¹ç•Œ
- è¾¹ç•Œè¦æ¸…æ™°å¯è§ï¼Œä¸å—èƒŒæ™¯å½±å“
- æ€§èƒ½è¦å¥½ï¼Œä¸èƒ½å¡é¡¿

**æŒ‘æˆ˜ï¼š**

- Canvasæ²¡æœ‰åŸç”Ÿçš„"æè¾¹"APIï¼ˆstrokeåªèƒ½æè·¯å¾„ï¼Œä¸èƒ½æå›¾åƒï¼‰
- éœ€è¦å¤„ç†é€æ˜åŒºåŸŸï¼ˆåªæéé€æ˜éƒ¨åˆ†çš„è¾¹ç•Œï¼‰
- éœ€è¦é€‚é…ä¸åŒå°ºå¯¸çš„mask

### 3.2 Canvasæè¾¹çš„æŠ€æœ¯å›°å¢ƒè¯¦è§£

åœ¨æ·±å…¥å®ç°ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä¸ºä»€ä¹ˆè¿™ä¸ªçœ‹ä¼¼ç®€å•çš„éœ€æ±‚åœ¨æŠ€æœ¯ä¸Šå´å¾ˆæœ‰æŒ‘æˆ˜æ€§ã€‚

#### Canvasçš„ä¸¤ç§ç»˜åˆ¶æ¨¡å¼

Canvas APIæä¾›äº†ä¸¤ç§å®Œå…¨ä¸åŒçš„ç»˜åˆ¶æ–¹å¼ï¼š

**1. çŸ¢é‡ç»˜åˆ¶ï¼ˆVector Drawingï¼‰**

è¿™æ˜¯Canvasçš„ä¼ ç»Ÿå¼ºé¡¹ï¼Œä½¿ç”¨è·¯å¾„ï¼ˆPathï¼‰APIæ¥ç»˜åˆ¶å‡ ä½•å›¾å½¢ï¼š

- `moveTo()`, `lineTo()` - ç»˜åˆ¶çº¿æ¡
- `arc()`, `arcTo()` - ç»˜åˆ¶åœ†å¼§
- `bezierCurveTo()` - ç»˜åˆ¶è´å¡å°”æ›²çº¿
- `rect()` - ç»˜åˆ¶çŸ©å½¢

è¿™äº›æ–¹æ³•çš„ç‰¹ç‚¹æ˜¯ï¼šå®ƒä»¬å®šä¹‰çš„æ˜¯"å½¢çŠ¶çš„æ•°å­¦æè¿°"ï¼Œè€Œä¸æ˜¯å…·ä½“çš„åƒç´ ã€‚å®Œæˆè·¯å¾„å®šä¹‰åï¼Œå¯ä»¥ä½¿ç”¨ï¼š

- `stroke()` - æè¾¹ï¼ˆç»˜åˆ¶è½®å»“ï¼‰
- `fill()` - å¡«å……ï¼ˆå¡«å……å†…éƒ¨ï¼‰

**2. ä½å›¾ç»˜åˆ¶ï¼ˆBitmap Drawingï¼‰**

è¿™æ˜¯å¤„ç†å›¾åƒæ•°æ®çš„æ–¹å¼ï¼š

- `drawImage()` - å°†å›¾åƒç»˜åˆ¶åˆ°canvas
- `putImageData()` - ç›´æ¥æ“ä½œåƒç´ æ•°æ®
- `getImageData()` - è¯»å–åƒç´ æ•°æ®

è¿™äº›æ–¹æ³•çš„ç‰¹ç‚¹æ˜¯ï¼šå®ƒä»¬å¤„ç†çš„æ˜¯"å·²ç»ç¡®å®šçš„åƒç´ "ï¼Œä¸æ˜¯æ•°å­¦å½¢çŠ¶ã€‚

#### æˆ‘ä»¬çš„å›°å¢ƒï¼šMaskæ˜¯ä½å›¾ï¼Œä¸æ˜¯çŸ¢é‡

SAMæ¨¡å‹è¿”å›çš„maskæ•°æ®æ˜¯**åƒç´ çº§åˆ«çš„åˆ†å‰²ç»“æœ**ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€å¼ ä½å›¾ï¼ˆbitmapï¼‰ï¼š

- æ¯ä¸ªåƒç´ è¦ä¹ˆé€æ˜ï¼ˆä¸å±äºè¯¥åˆ†åŒºï¼‰
- è¦ä¹ˆä¸é€æ˜ï¼ˆå±äºè¯¥åˆ†åŒºï¼‰

è¿™äº›maskå­˜å‚¨åœ¨Canvasä¸­ï¼Œæ˜¯çº¯ç²¹çš„åƒç´ æ•°æ®ã€‚å®ƒä»¬ä¸æ˜¯çŸ¢é‡è·¯å¾„ï¼Œæ²¡æœ‰"è¾¹ç•Œçº¿"çš„æ•°å­¦æè¿°ï¼Œåªæœ‰ä¸€å †åƒç´ ç‚¹ã€‚

#### ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ç”¨stroke()ï¼Ÿ

Canvasçš„`stroke()`æ–¹æ³•åªèƒ½æç»˜è·¯å¾„ï¼Œè€Œä¸èƒ½æç»˜ä½å›¾ã€‚æˆ‘ä»¬æœ‰çš„æ˜¯è¿™æ ·çš„æ•°æ®ï¼š

```
åƒç´ æ•°æ®ï¼ˆmaskï¼‰ï¼š
[0, 0, 0, 255, 255, 255, ...]  // 0=é€æ˜ï¼Œ255=ä¸é€æ˜
```

è€Œ`stroke()`éœ€è¦çš„æ˜¯è¿™æ ·çš„æ•°æ®ï¼š

```
è·¯å¾„æ•°æ®ï¼ˆpathï¼‰ï¼š
moveTo(10, 20)
lineTo(30, 40)
bezierCurveTo(50, 60, 70, 80, 90, 100)
...
```

**ç†è®ºä¸Šçš„è§£å†³æ–¹æ¡ˆ1ï¼šå°†ä½å›¾è½¬æ¢ä¸ºçŸ¢é‡è·¯å¾„**

å¯ä»¥é€šè¿‡ç®—æ³•å°†maskçš„è¾¹ç•Œè½¬æ¢ä¸ºçŸ¢é‡è·¯å¾„ï¼ˆæ¯”å¦‚ä½¿ç”¨Marching Squaresç®—æ³•ï¼‰ï¼Œç„¶åç”¨`stroke()`æè¾¹ã€‚

ä½†è¿™ä¸ªæ–¹æ¡ˆçš„é—®é¢˜æ˜¯ï¼š

- âŒ ç®—æ³•å¤æ‚åº¦é«˜ï¼Œæ€§èƒ½å¼€é”€å¤§
- âŒ å¯¹äºå¤æ‚å½¢çŠ¶ï¼ˆå¦‚å¤´å‘ä¸ï¼‰ï¼Œä¼šç”Ÿæˆå¤§é‡çš„æ§åˆ¶ç‚¹
- âŒ éœ€è¦é¢å¤–çš„åº“æˆ–æ‰‹å†™å¤æ‚ç®—æ³•
- âŒ å®æ—¶å“åº”ï¼ˆhoveræ—¶ï¼‰ä¼šé€ æˆå¡é¡¿

**ç†è®ºä¸Šçš„è§£å†³æ–¹æ¡ˆ2ï¼šé€åƒç´ ç»˜åˆ¶è¾¹ç•Œ**

éå†maskçš„æ¯ä¸ªåƒç´ ï¼Œæ£€æµ‹è¾¹ç•Œç‚¹ï¼ˆé€æ˜åƒç´ æ—è¾¹çš„ä¸é€æ˜åƒç´ ï¼‰ï¼Œç„¶åé€ä¸ªç»˜åˆ¶è¾¹æ¡†åƒç´ ã€‚

ä½†è¿™ä¸ªæ–¹æ¡ˆçš„é—®é¢˜æ˜¯ï¼š

- âŒ éœ€è¦åŒé‡å¾ªç¯éå†æ‰€æœ‰åƒç´ ï¼Œæ€§èƒ½æå·®
- âŒ ç»˜åˆ¶å‡ºçš„è¾¹æ¡†æ²¡æœ‰æŠ—é”¯é½¿æ•ˆæœï¼Œå¾ˆç²—ç³™
- âŒ è¾¹æ¡†å®½åº¦éš¾ä»¥æ§åˆ¶ï¼ˆåªèƒ½æ˜¯1åƒç´ çš„æ•´æ•°å€ï¼‰

#### æˆ‘ä»¬çš„å·§å¦™è§£å†³æ–¹æ¡ˆï¼šå†…é˜´å½±æŠ€æœ¯

æ—¢ç„¶æ­£é¢è¿›æ”»ä¸å¯è¡Œï¼Œæˆ‘ä»¬æ¢ä¸€ä¸ªæ€è·¯ï¼š**ä¸ç›´æ¥æè¾¹ï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ª"çœ‹èµ·æ¥åƒè¾¹æ¡†"çš„è§†è§‰æ•ˆæœ**ã€‚

å…³é”®æ´å¯Ÿï¼š**å†…é˜´å½±åœ¨è¾¹ç¼˜çš„æ•ˆæœï¼Œè§†è§‰ä¸Šç­‰åŒäºè¾¹æ¡†**

æƒ³è±¡è¿™æ ·ä¸€ä¸ªç±»æ¯”ï¼š

- ä¸€ä¸ªä¸é€æ˜çš„å›¾å½¢ï¼Œå¦‚æœåœ¨è¾¹ç¼˜å†…ä¾§æœ‰ä¸€åœˆé˜´å½±
- ä»è§†è§‰ä¸Šçœ‹ï¼Œè¿™åœˆé˜´å½±å°±åƒæ˜¯"è¾¹æ¡†"

è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„æŠ€æœ¯ï¼š**ä¸æ˜¯çœŸçš„æè¾¹ï¼Œè€Œæ˜¯åœ¨maskè¾¹ç¼˜ç”Ÿæˆå†…é˜´å½±**ã€‚

### 3.3 å†…é˜´å½±æŠ€æœ¯çš„å®ç°åŸç†

#### æ ¸å¿ƒæ€è·¯

é¡¹ç›®ä½¿ç”¨**å†…é˜´å½±ï¼ˆInset Shadowï¼‰**æŠ€æœ¯å®ç°é«˜äº®ï¼Œæ•´ä½“æµç¨‹æ˜¯ï¼š

```
1. å°†layer.maskCanvasä½œä¸º"é®ç½©"ï¼ˆå®šä¹‰å“ªäº›åŒºåŸŸéœ€è¦æ•ˆæœï¼‰
2. åˆ©ç”¨Canvasçš„shadowBlur APIåœ¨è¾¹ç¼˜ç”Ÿæˆæ¨¡ç³Šé˜´å½±
3. é€šè¿‡destination-inæ··åˆæ¨¡å¼ï¼Œå°†é˜´å½±é™åˆ¶åœ¨maskåŒºåŸŸå†…
4. é‡å¤å åŠ å¤šæ¬¡ï¼Œå¢å¼ºè¾¹æ¡†å¯è§åº¦
5. å°†æœ€ç»ˆç»“æœç»˜åˆ¶åˆ°selectionCanvasä¸Šæ˜¾ç¤º
```

#### ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆå¯è¡Œï¼Ÿ

Canvasæä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„é˜´å½±APIï¼š

- `shadowBlur` - é˜´å½±çš„æ¨¡ç³ŠåŠå¾„
- `shadowColor` - é˜´å½±çš„é¢œè‰²
- `shadowOffsetX/Y` - é˜´å½±çš„åç§»

è¿™ä¸ªAPIåŸæœ¬æ˜¯ç”¨æ¥ç»™å›¾å½¢æ·»åŠ æŠ•å½±æ•ˆæœçš„ï¼ˆç±»ä¼¼CSSçš„`box-shadow`ï¼‰ï¼Œä½†æˆ‘ä»¬å¯ä»¥"æ»¥ç”¨"å®ƒæ¥åˆ›é€ è¾¹æ¡†æ•ˆæœã€‚

å…³é”®æŠ€å·§ï¼š

1. ä½¿ç”¨maskä½œä¸ºé®ç½©ï¼Œé™åˆ¶é˜´å½±åªå‡ºç°åœ¨maskåŒºåŸŸå†…
2. è®¾ç½®`shadowOffsetX/Y = 0`ï¼Œè®©é˜´å½±ä¸åç§»
3. è®¾ç½®è¾ƒå¤§çš„`shadowBlur`ï¼Œè®©é˜´å½±åœ¨è¾¹ç¼˜æ‰©æ•£
4. å¡«å……æ•´ä¸ªåŒºåŸŸï¼Œè§¦å‘é˜´å½±æ•ˆæœ
5. ç”±äºæ··åˆæ¨¡å¼é™åˆ¶ï¼Œé˜´å½±åªä¼šå‡ºç°åœ¨è¾¹ç¼˜ï¼ˆä¸­å¿ƒè¢«é®æŒ¡ï¼‰

### 3.4 å®ç°æ–¹æ¡ˆï¼šå†…é˜´å½±æŠ€æœ¯

é¡¹ç›®ä½¿ç”¨**å†…é˜´å½±ï¼ˆInset Shadowï¼‰**æŠ€æœ¯å®ç°é«˜äº®ï¼Œæ ¸å¿ƒæ€è·¯ï¼š

```
1. å°†layer.maskCanvasä½œä¸º"é®ç½©"
2. ä½¿ç”¨å†…é˜´å½±åœ¨é®ç½©è¾¹ç¼˜ç”Ÿæˆè¾¹æ¡†æ•ˆæœ
3. å°†ç»“æœç»˜åˆ¶åˆ°selectionCanvasä¸Š
```

### 3.3 æ ¸å¿ƒä»£ç è§£æ

#### **æ­¥éª¤1ï¼šaddBorderToCanvaså…¥å£**

```typescript
// use-auto-masks.ts (132-137è¡Œ)
addBorderToCanvas(layer.maskCanvas, hoverCanvasRef.value!, {
  borderWidth:
    Math.max(1, (2 * layer.maskCanvas.width) / hoverCanvasRef.value!.width) * pixelRatio.value,
  borderColor: AUTO_MASK_HOVER_BORDER_COLOR, // #33C8E6 é’è‰²
});
```

**å‚æ•°è¯´æ˜ï¼š**

- `layer.maskCanvas`ï¼šæºmaskå›¾åƒï¼ˆè¦æè¾¹çš„å›¾åƒï¼‰
- `hoverCanvasRef.value!`ï¼šç›®æ ‡canvasï¼ˆæ˜¾ç¤ºé«˜äº®çš„canvasï¼‰
- `borderWidth`ï¼šè¾¹æ¡†å®½åº¦ï¼ˆå“åº”å¼è®¡ç®—ï¼‰
- `borderColor`ï¼šè¾¹æ¡†é¢œè‰²ï¼ˆé’è‰²ï¼‰

#### **æ­¥éª¤2ï¼šå†…é˜´å½±ç”Ÿæˆ**

```typescript
// utils/canvas.ts (114-145è¡Œ)
export function addBorderToCanvas(
  sourceCanvas: HTMLCanvasElement, // layer.maskCanvas
  targetCanvas: HTMLCanvasElement, // selectionCanvas
  options: {
    borderColor: string;
    borderWidth: number;
  },
) {
  const targetCtx = targetCanvas.getContext('2d')!;

  // æ­¥éª¤2.1ï¼šç”Ÿæˆå†…é˜´å½±
  const insetShadowCanvas = addInsetShadowToCanvas(sourceCanvas, targetCanvas, {
    blur: options.borderWidth, // æ¨¡ç³ŠåŠå¾„ = è¾¹æ¡†å®½åº¦
    color: options.borderColor, // è¾¹æ¡†é¢œè‰²
    offsetX: 0,
    offsetY: 0,
  });

  // æ­¥éª¤2.2ï¼šå¼ºåŒ–è¾¹æ¡†æ•ˆæœï¼ˆå¤šæ¬¡ç»˜åˆ¶ï¼‰
  const insetShadowCtx = insetShadowCanvas.getContext('2d')!;
  for (let i = 0; i < 50; i++) {
    // é‡å¤ç»˜åˆ¶50æ¬¡ï¼Œå¢å¼ºæ•ˆæœ
    insetShadowCtx.drawImage(
      insetShadowCanvas,
      0,
      0,
      insetShadowCanvas.width,
      insetShadowCanvas.height,
    );
  }

  // æ­¥éª¤2.3ï¼šç»˜åˆ¶åˆ°ç›®æ ‡canvas
  targetCtx.drawImage(insetShadowCanvas, 0, 0, targetCanvas.width, targetCanvas.height);

  cleanCanvas(insetShadowCanvas);
}
```

#### **æ­¥éª¤3ï¼šå†…é˜´å½±æ ¸å¿ƒç®—æ³•**

```typescript
// utils/canvas.ts (56-109è¡Œ)
function addInsetShadowToCanvas(
  sourceCanvas: HTMLCanvasElement,
  targetCanvas: HTMLCanvasElement,
  options: { blur: number; color: string; offsetX: number; offsetY: number },
) {
  const { width, height } = targetCanvas;
  const resultCanvas = createCanvas(width, height);
  const resultCtx = resultCanvas.getContext('2d')!;

  // æ­¥éª¤3.1ï¼šç»˜åˆ¶æºå›¾åƒï¼ˆä½œä¸ºé®ç½©ï¼‰
  resultCtx.drawImage(sourceCanvas, 0, 0, width, height);

  // æ­¥éª¤3.2ï¼šè®¾ç½®æ··åˆæ¨¡å¼ä¸º"destination-in"
  // æ•ˆæœï¼šåªä¿ç•™æºå›¾åƒçš„éé€æ˜åŒºåŸŸ
  resultCtx.globalCompositeOperation = 'destination-in';
  resultCtx.drawImage(sourceCanvas, 0, 0, width, height);

  // æ­¥éª¤3.3ï¼šæ¢å¤æ··åˆæ¨¡å¼ï¼Œç»˜åˆ¶é˜´å½±
  resultCtx.globalCompositeOperation = 'source-over';

  // æ­¥éª¤3.4ï¼šåº”ç”¨é˜´å½±æ»¤é•œï¼ˆæ¨¡æ‹Ÿå†…é˜´å½±ï¼‰
  resultCtx.shadowBlur = options.blur;
  resultCtx.shadowColor = options.color;
  resultCtx.shadowOffsetX = options.offsetX;
  resultCtx.shadowOffsetY = options.offsetY;

  // æ­¥éª¤3.5ï¼šç»˜åˆ¶å¡«å……ï¼ˆè§¦å‘é˜´å½±ï¼‰
  resultCtx.fillStyle = options.color;
  resultCtx.fillRect(0, 0, width, height);

  // æ­¥éª¤3.6ï¼šåº”ç”¨é¢œè‰²ï¼ˆå¯é€‰ï¼Œç”¨äºé¢„è§ˆï¼‰
  const colorCanvas = colorizeCanvas(resultCanvas, AUTO_MASK_HOVER_FILL_COLOR);
  resultCtx.clearRect(0, 0, width, height);
  resultCtx.drawImage(colorCanvas, 0, 0, width, height);
  cleanCanvas(colorCanvas);

  return resultCanvas;
}
```

### 3.4 æŠ€æœ¯åŸç†å›¾è§£

```
åŸå§‹maskCanvasï¼ˆé»‘ç™½maskï¼‰
    â†“
[æ­¥éª¤1] ç»˜åˆ¶åˆ°ä¸´æ—¶canvas
    â†“
[æ­¥éª¤2] ä½¿ç”¨destination-inæ··åˆæ¨¡å¼
    â†“  ï¼ˆåªä¿ç•™éé€æ˜åŒºåŸŸï¼‰
[æ­¥éª¤3] åº”ç”¨å†…é˜´å½±
    â†“  ï¼ˆshadowBluråœ¨è¾¹ç¼˜ç”Ÿæˆå…‰æ™•ï¼‰
[æ­¥éª¤4] é‡å¤ç»˜åˆ¶50æ¬¡
    â†“  ï¼ˆå¼ºåŒ–è¾¹æ¡†æ•ˆæœï¼‰
[æ­¥éª¤5] ç»˜åˆ¶åˆ°selectionCanvas
    â†“
æœ€ç»ˆæ•ˆæœï¼šé’è‰²è¾¹æ¡†é«˜äº®
```

### 3.5 å…³é”®æŠ€æœ¯ç‚¹

#### **1. æ··åˆæ¨¡å¼ï¼šdestination-in**

```typescript
ctx.globalCompositeOperation = 'destination-in';
```

**ä½œç”¨ï¼š**

- åªä¿ç•™ç›®æ ‡canvasä¸­ä¸æºå›¾åƒé‡å çš„éé€æ˜åŒºåŸŸ
- ç›¸å½“äº"é®ç½©"æ•ˆæœ
- ç¡®ä¿é˜´å½±åªåœ¨maskåŒºåŸŸå†…æ˜¾ç¤º

#### **2. å†…é˜´å½±æ¨¡æ‹Ÿ**

```typescript
ctx.shadowBlur = options.borderWidth;
ctx.shadowColor = options.borderColor;
ctx.fillRect(0, 0, width, height);
```

**åŸç†ï¼š**

- Canvasçš„`shadowBlur`ä¼šåœ¨ç»˜åˆ¶å†…å®¹çš„è¾¹ç¼˜ç”Ÿæˆæ¨¡ç³Šé˜´å½±
- é€šè¿‡å¡«å……æ•´ä¸ªcanvasï¼Œåœ¨maskè¾¹ç¼˜ç”Ÿæˆå…‰æ™•æ•ˆæœ
- æ¨¡æ‹Ÿ"å†…é˜´å½±"çš„è§†è§‰æ•ˆæœ

#### **3. é‡å¤ç»˜åˆ¶å¼ºåŒ–**

```typescript
for (let i = 0; i < 50; i++) {
    insetShadowCtx.drawImage(insetShadowCanvas, 0, 0, ...);
}
```

**ç›®çš„ï¼š**

- å¤šæ¬¡å åŠ é˜´å½±ï¼Œä½¿è¾¹æ¡†æ›´æ˜æ˜¾
- å¢å¼ºè§†è§‰æ•ˆæœ
- è™½ç„¶æ€§èƒ½æœ‰æŸè€—ï¼Œä½†hoveræ“ä½œé¢‘ç‡ä½ï¼Œå¯æ¥å—

### 3.6 å“åº”å¼è¾¹æ¡†å®½åº¦

```typescript
borderWidth: Math.max(1, (2 * layer.maskCanvas.width) / hoverCanvasRef.value!.width) *
  pixelRatio.value;
```

**è®¡ç®—é€»è¾‘ï¼š**

- `2 * layer.maskCanvas.width / hoverCanvasRef.value!.width`ï¼šæ ¹æ®canvasç¼©æ”¾æ¯”ä¾‹è®¡ç®—
- `* pixelRatio.value`ï¼šè€ƒè™‘è®¾å¤‡DPI
- `Math.max(1, ...)`ï¼šç¡®ä¿æœ€å°1pxï¼Œé¿å…é«˜DPIè®¾å¤‡è¾¹æ¡†è¿‡ç»†

### 3.7 æ€§èƒ½ä¼˜åŒ–è€ƒè™‘

**å½“å‰å®ç°ï¼š**

- âœ… ä½¿ç”¨èŠ‚æµï¼šhoveräº‹ä»¶æœ¬èº«ä¸éœ€è¦èŠ‚æµï¼ˆå·²ç”±æµè§ˆå™¨ä¼˜åŒ–ï¼‰
- âœ… ç¦»å±canvasï¼šä½¿ç”¨ä¸´æ—¶canvasï¼Œé¿å…æ±¡æŸ“ä¸»canvas
- âœ… åŠæ—¶æ¸…ç†ï¼šä½¿ç”¨`cleanCanvas`é‡Šæ”¾å†…å­˜

**æ½œåœ¨ä¼˜åŒ–ï¼š**

- âš ï¸ é‡å¤ç»˜åˆ¶50æ¬¡å¯èƒ½å½±å“æ€§èƒ½ï¼ˆä½†hoveré¢‘ç‡ä½ï¼Œå¯æ¥å—ï¼‰
- ğŸ’¡ å¯ä»¥è€ƒè™‘ä½¿ç”¨WebGLåŠ é€Ÿ
- ğŸ’¡ å¯ä»¥ç¼“å­˜é«˜äº®ç»“æœï¼ˆç›¸åŒlayerä¸é‡å¤è®¡ç®—ï¼‰

### 3.8 é«˜äº®å®ç°çš„æ·±åº¦è§£æï¼ˆè¯¦ç»†æ–‡å­—è¯´æ˜ï¼‰

#### ä¸ºä»€ä¹ˆCanvasæè¾¹è¿™ä¹ˆå›°éš¾ï¼Ÿ

åœ¨Canvasä¸­ï¼Œå¦‚æœè¦ç»™çŸ©å½¢æˆ–åœ†å½¢æè¾¹éå¸¸ç®€å•ï¼Œä½†æˆ‘ä»¬é¢å¯¹çš„maskæ˜¯**åƒç´ ä½å›¾**â€”â€”æˆåƒä¸Šä¸‡ä¸ªåƒç´ ç‚¹ç»„æˆçš„ä¸è§„åˆ™å½¢çŠ¶ï¼ˆäººç‰©è½®å»“ã€å¤´å‘ä¸ã€æ‰‹æŒ‡ç­‰ï¼‰ï¼Œæ ¹æœ¬æ²¡æœ‰ç®€å•çš„å‡ ä½•è·¯å¾„å¯ä»¥æè¿°ã€‚

**æ ¸å¿ƒçŸ›ç›¾ï¼š** Canvasçš„`stroke()`åªèƒ½æè·¯å¾„ï¼Œä¸èƒ½æä½å›¾çš„è¾¹ç•Œã€‚

è™½ç„¶ç†è®ºä¸Šå¯ä»¥é€šè¿‡ç®—æ³•å°†ä½å›¾è¾¹ç•Œæå–ä¸ºçŸ¢é‡è·¯å¾„ï¼Œä½†è¿™ä¼šå¸¦æ¥ï¼šè®¡ç®—é‡å¤§ã€è·¯å¾„å¤æ‚ã€å®æ—¶æ€§å·®ã€æŠ—é”¯é½¿å·®ç­‰é—®é¢˜ã€‚åœ¨ç”¨æˆ·hoveræ—¶éœ€è¦ç«‹å³å“åº”ï¼Œæ²¡æœ‰æ—¶é—´åšå¤æ‚è®¡ç®—ã€‚

#### å†…é˜´å½±æŠ€æœ¯çš„å·§å¦™æ€è·¯

æ—¢ç„¶æ­£é¢æè¾¹å¾ˆéš¾ï¼Œæˆ‘ä»¬æ¢ä¸ªæ€è·¯ï¼š**èƒ½ä¸èƒ½åˆ›é€ ä¸€ä¸ª"çœ‹èµ·æ¥åƒè¾¹æ¡†"çš„è§†è§‰æ•ˆæœï¼Ÿ**

å¦‚æœåœ¨maskçš„è¾¹ç¼˜å†…ä¾§ç”Ÿæˆä¸€åœˆæ¨¡ç³Šçš„é¢œè‰²ï¼Œä»è§†è§‰ä¸Šçœ‹ï¼Œè¿™å°±æ˜¯"è¾¹æ¡†"ï¼è¿™å°±æ˜¯**å†…é˜´å½±ï¼ˆInset Shadowï¼‰æŠ€æœ¯**çš„æ ¸å¿ƒæ€æƒ³ã€‚

#### ç®—æ³•çš„é€æ­¥å·¥ä½œåŸç†

**æ­¥éª¤1ï¼šåˆ›å»ºæ²™ç›’ç¯å¢ƒï¼ˆä¸´æ—¶canvasï¼‰**

å°±åƒåšèœè¦å…ˆå‡†å¤‡æ¡ˆæ¿ï¼Œæˆ‘ä»¬åˆ›å»ºä¸´æ—¶ç”»å¸ƒï¼ˆresultCanvasï¼‰ï¼Œåœ¨ä¸Šé¢å®Œæˆæ‰€æœ‰æ“ä½œï¼Œé¿å…"æ±¡æŸ“"ç›®æ ‡ç”»å¸ƒã€‚è¿™æ ·ä¸‡ä¸€å‡ºé”™å¯ä»¥å®‰å…¨å›é€€ã€‚

**æ­¥éª¤2ï¼šå»ºç«‹"ä¸å¯é€¾è¶Šçš„è¾¹ç•Œ"ï¼ˆdestination-inæ··åˆæ¨¡å¼ï¼‰**

```typescript
resultCtx.globalCompositeOperation = 'destination-in';
resultCtx.drawImage(sourceCanvas, 0, 0, width, height);
```

è¿™ä¸€æ­¥çœ‹èµ·æ¥å¥‡æ€ªâ€”â€”ä¸ºä»€ä¹ˆæŠŠåŒä¸€ä¸ªå›¾åƒå†ç”»ä¸€éï¼Ÿ

æƒ³è±¡ä½ åœ¨çº¸ä¸Šç”»äº†äººç‰©è½®å»“ï¼Œè¦ç»™è½®å»“æ¶‚è‰²ï¼Œä½†é¢œè‰²ç»å¯¹ä¸èƒ½è¶…å‡ºè½®å»“çº¿ã€‚ä½ ä¼šå…ˆç”¨é€æ˜èƒ¶å¸¦æŠŠè½®å»“çº¿å¤–çš„åŒºåŸŸå…¨éƒ¨å°ä½ã€‚

`destination-in`æ··åˆæ¨¡å¼å°±æ˜¯è¿™ä¸ª"é€æ˜èƒ¶å¸¦"ï¼Œå®ƒçš„è§„åˆ™æ˜¯ï¼š**åªä¿ç•™ä¸maské‡å çš„ä¸é€æ˜åŒºåŸŸ**ã€‚è™½ç„¶è§†è§‰ä¸Šæ²¡å˜åŒ–ï¼Œä½†canvaså·²ç»è¢«"åŠ å¯†"äº†â€”â€”åç»­ä»»ä½•ç»˜åˆ¶éƒ½ä¼šè¢«é™åˆ¶åœ¨maskåŒºåŸŸå†…ï¼Œå»ºç«‹äº†ä¸€ä¸ª"ä¸å¯é€¾è¶Šçš„è¾¹ç•Œ"ã€‚

**æ­¥éª¤3ï¼šé…ç½®é˜´å½±å‚æ•°**

```typescript
resultCtx.shadowBlur = 4; // æ¨¡ç³ŠåŠå¾„4åƒç´ 
resultCtx.shadowColor = '#33C8E6'; // é’è‰²
resultCtx.shadowOffset = 0; // ä¸åç§»
```

è¿™ä¸€æ­¥æ˜¯åœ¨"è®¾ç½®é­”æ³•å’’è¯­"ã€‚æˆ‘ä»¬å‘Šè¯‰Canvasï¼š"æ¥ä¸‹æ¥å¦‚æœæœ‰ä¸œè¥¿è¢«ç”»å‡ºæ¥ï¼Œè¯·è‡ªåŠ¨ç»™å®ƒåŠ ä¸Šé˜´å½±"ã€‚ä½†è¿™åªæ˜¯è®¾ç½®ï¼Œè¿˜æ²¡æœ‰çœŸæ­£ç”»ä¸œè¥¿ã€‚

å…³é”®ç‚¹ï¼š

- `shadowBlur`æ§åˆ¶æ¨¡ç³Šç¨‹åº¦ï¼Œå€¼è¶Šå¤§æ‰©æ•£è¶Šè¿œ
- `shadowColor`ç”¨é’è‰²ï¼ˆä¸æ˜¯ä¼ ç»Ÿçš„é»‘è‰²æŠ•å½±ï¼‰ï¼Œå› ä¸ºè¦åšé«˜äº®
- `shadowOffset = 0`ä¸åç§»ï¼Œè®©é˜´å½±å›´ç»•å¯¹è±¡å‡åŒ€æ‰©æ•£

**å½“é˜´å½±ä¸åç§»æ—¶ï¼Œå®ƒä¼šåœ¨å¯¹è±¡è¾¹ç¼˜å‡åŒ€æ‰©æ•£ï¼Œè¿™åœ¨è§†è§‰ä¸Šå°±æ˜¯"è¾¹æ¡†"ï¼**

**æ­¥éª¤4ï¼šè§¦å‘é˜´å½±æ•ˆæœ**

```typescript
resultCtx.fillRect(0, 0, width, height);
```

ç”¨é’è‰²å¡«å……æ•´ä¸ªcanvasã€‚ç­‰ç­‰ï¼Œè¿™ä¸ä¼šæŠŠæ•´ä¸ªç”»å¸ƒéƒ½æ¶‚æˆé’è‰²å—ï¼Ÿ

ä¸ä¼šï¼å› ä¸ºæ­¥éª¤2çš„"é€æ˜èƒ¶å¸¦"ä¿æŠ¤ï¼Œåªæœ‰maskçš„ä¸é€æ˜åŒºåŸŸä¼šè¢«æ¶‚è‰²ã€‚

**é˜´å½±çš„è§¦å‘æœºåˆ¶ï¼š** Canvasçš„é˜´å½±åªæœ‰åœ¨"ç»˜åˆ¶æ“ä½œ"å‘ç”Ÿæ—¶æ‰ä¼šè§¦å‘ã€‚`fillRect`å°±æ˜¯è¿™ä¸ªè§¦å‘åŠ¨ä½œã€‚Canvasä¼šåœ¨è¢«å¡«å……åŒºåŸŸçš„è¾¹ç¼˜è‡ªåŠ¨ç”Ÿæˆé˜´å½±ã€‚

**ä¸ºä»€ä¹ˆé˜´å½±åªåœ¨è¾¹ç¼˜ï¼Ÿ** é˜´å½±å‘å†…å¤–ä¸¤ä¾§æ‰©æ•£ï¼Œå¤–ä¾§è¢«maskè¾¹ç•Œæˆªæ–­ï¼Œå†…ä¾§ä¿ç•™ä¸‹æ¥å½¢æˆ"å†…é˜´å½±"ï¼Œè€Œä¸­å¿ƒè¢«å¡«å……é¢œè‰²è¦†ç›–çœ‹ä¸åˆ°é˜´å½±ã€‚

**æ­¥éª¤5ï¼šå¼ºåŒ–æ•ˆæœï¼ˆé‡å¤ç»˜åˆ¶50æ¬¡ï¼‰**

```typescript
for (let i = 0; i < 50; i++) {
  insetShadowCtx.drawImage(insetShadowCanvas, 0, 0, width, height);
}
```

è¿™çœ‹èµ·æ¥å¾ˆå¥‡æ€ªâ€”â€”æŠŠcanvasç”»åˆ°è‡ªå·±èº«ä¸Š50æ¬¡ï¼Ÿ

æƒ³è±¡ç”¨æ°´å½©ç¬”ç”»ç”»ï¼šä¸€æ¬¡æ¶‚æŠ¹é¢œè‰²å¾ˆæ·¡ï¼Œæ¶‚50æ¬¡é¢œè‰²éå¸¸é²œè‰³ã€‚

**é—®é¢˜ï¼š** åˆå§‹é˜´å½±å¤ªæ·¡ï¼ˆå› ä¸ºæ¨¡ç³Šç®—æ³•ä¼šé™ä½ä¸é€æ˜åº¦ï¼‰
**è§£å†³ï¼š** é€šè¿‡å åŠ ç»˜åˆ¶ç´¯ç§¯ä¸é€æ˜åº¦ï¼Œè®©è¾¹æ¡†ä»æ·¡é’è‰²å˜æˆæ¸…æ™°çš„é’è‰²è¾¹æ¡†

50æ¬¡æ˜¯ç»éªŒå€¼ï¼Œåœ¨"æ¸…æ™°åº¦"å’Œ"æ€§èƒ½"ä¹‹é—´å–å¾—å¹³è¡¡ã€‚

#### è¾¹æ¡†å®½åº¦çš„è‡ªé€‚åº”è®¡ç®—

```typescript
borderWidth: Math.max(1, (2 * layer.maskCanvas.width) / hoverCanvasRef.value!.width) *
  pixelRatio.value;
```

è¿™ä¸ªå…¬å¼çš„ç›®çš„ï¼š**è®©è¾¹æ¡†åœ¨ä»»ä½•ç¼©æ”¾çº§åˆ«å’Œä»»ä½•è®¾å¤‡ä¸Šéƒ½"çœ‹èµ·æ¥ä¸€æ ·ç²—"**ã€‚

å¦‚æœå›ºå®š4åƒç´ ï¼šåŸå§‹mask 2000pxå®½æ—¶è¾¹æ¡†å 0.2%ï¼Œç¼©å°åˆ°500pxæ—¶è¾¹æ¡†è¿˜æ˜¯4pxï¼Œå æ¯”å˜æˆ0.8%ï¼Œçœ‹èµ·æ¥å˜ç²—äº†4å€ï¼

è§£å†³æ–¹æ¡ˆï¼š

- ç¬¬ä¸€éƒ¨åˆ†ï¼šæ ¹æ®ç¼©æ”¾æ¯”ä¾‹è°ƒæ•´ï¼ˆmaskç¼©å°4å€ï¼Œè¾¹æ¡†å°±æ”¾å¤§8å€ï¼‰
- ç¬¬äºŒéƒ¨åˆ†ï¼š`Math.max(1, ...)`ç¡®ä¿è‡³å°‘1åƒç´ 
- ç¬¬ä¸‰éƒ¨åˆ†ï¼š`* pixelRatio`é€‚é…é«˜DPIå±å¹•ï¼ˆRetinaå±å¹•ç¿»å€ï¼‰

æœ€ç»ˆç»“æœï¼šæ— è®ºä»€ä¹ˆè®¾å¤‡ã€ä»€ä¹ˆç¼©æ”¾ï¼Œè¾¹æ¡†çš„è§†è§‰ç²—ç»†éƒ½ä¿æŒä¸€è‡´ã€‚

#### å®Œæ•´æµç¨‹çš„è§†è§‰å˜åŒ–

| æ­¥éª¤    | è§†è§‰æ•ˆæœ                      | æ ¸å¿ƒå˜åŒ–                           |
| ------- | ----------------------------- | ---------------------------------- |
| æ­¥éª¤1   | ç™½è‰²äººç‰©è½®å»“                  | å¤åˆ¶maskåˆ°ä¸´æ—¶canvas               |
| æ­¥éª¤2   | ç™½è‰²äººç‰©è½®å»“ï¼ˆçœ‹ä¼¼æ²¡å˜ï¼‰      | **å†…éƒ¨å»ºç«‹è¾¹ç•Œè§„åˆ™ï¼ˆå…³é”®ï¼ï¼‰**     |
| æ­¥éª¤3-4 | ç™½è‰²äººç‰©è½®å»“                  | é…ç½®é˜´å½±å‚æ•°                       |
| æ­¥éª¤5   | é’è‰²è½®å»“ + æ·¡é’è‰²è¾¹ç¼˜å…‰æ™•     | **è§¦å‘é˜´å½±ï¼Œç”Ÿæˆå†…è¾¹æ¡†ï¼ˆå…³é”®ï¼ï¼‰** |
| æ­¥éª¤6   | é’è‰²è½®å»“ + **æ¸…æ™°çš„**é’è‰²è¾¹æ¡† | **å¼ºåŒ–50æ¬¡ï¼Œè¾¹æ¡†æ˜æ˜¾ï¼ˆå…³é”®ï¼ï¼‰**   |

å…³é”®è½¬æŠ˜ç‚¹åœ¨æ­¥éª¤2ï¼ˆå»ºç«‹è¾¹ç•Œï¼‰ã€æ­¥éª¤5ï¼ˆè§¦å‘é˜´å½±ï¼‰ã€æ­¥éª¤6ï¼ˆå¼ºåŒ–æ•ˆæœï¼‰ã€‚

#### è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜åŠ¿

1. **æ€§èƒ½å¥½ï¼š** åˆ©ç”¨CanvasåŸç”Ÿé˜´å½±APIï¼ŒGPUåŠ é€Ÿï¼Œå®æ—¶å“åº”
2. **æ•ˆæœå¥½ï¼š** è‡ªç„¶çš„æ¨¡ç³Šè¾¹ç¼˜ï¼ŒæŠ—é”¯é½¿ï¼Œè§†è§‰èˆ’é€‚
3. **é€‚åº”æ€§å¼ºï¼š** å¯å¤„ç†ä»»æ„å¤æ‚å½¢çŠ¶ï¼ˆå¤´å‘ä¸ã€æ‰‹æŒ‡ç­‰ï¼‰
4. **å®ç°ç®€å•ï¼š** ä¸éœ€è¦å¤æ‚çš„è¾¹ç•Œæå–ç®—æ³•
5. **å¯æ§æ€§å¼ºï¼š** è¾¹æ¡†å®½åº¦ã€é¢œè‰²ã€æ¨¡ç³Šåº¦éƒ½å¯çµæ´»è°ƒæ•´

**æ ¸å¿ƒæ´å¯Ÿï¼š** é€šè¿‡"æ»¥ç”¨"Canvasçš„é˜´å½±APIï¼Œå°†ä¼ ç»Ÿçš„æŠ•å½±æ•ˆæœè½¬åŒ–ä¸ºè¾¹æ¡†æ•ˆæœã€‚è¿™ç§"è·¨ç•Œä½¿ç”¨"æ­£æ˜¯ç®—æ³•å·§å¦™ä¹‹å¤„ã€‚

---

## å››ã€å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µä¸€ï¼šåˆå§‹åŒ–                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ç”¨æˆ·é€‰æ‹©"ä¸»ä½“é€‰æ‹©"å·¥å…·                               â”‚
â”‚  2. è·å–å›¾ç‰‡URL                                          â”‚
â”‚  3. æ£€æŸ¥ç¼“å­˜ï¼ˆjsonMapï¼‰                                  â”‚
â”‚  4. è°ƒç”¨åç«¯APIè·å–SAMåˆ†åŒºæ•°æ®                           â”‚
â”‚     factory.apiService.autoMasks(imageUrl)              â”‚
â”‚  5. åˆ›å»ºAutoMaskModelå®ä¾‹                                â”‚
â”‚     factory.createAutoMaskModel(url, maskData)          â”‚
â”‚     â†’ ç”Ÿæˆå¤šä¸ªAutoMaskLayerå¯¹è±¡                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µäºŒï¼šäº¤äº’å¤„ç†ï¼ˆHoverï¼‰                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  6. é¼ æ ‡hoveräº‹ä»¶è§¦å‘                                    â”‚
â”‚     useEventListener('mousemove', handleHoverMask)      â”‚
â”‚  7. åæ ‡è½¬æ¢ï¼ˆé¡¹ç›®å®ç°ï¼‰                                 â”‚
â”‚     pointFormEvent(e) â†’ {x, y}                          â”‚
â”‚     å±å¹•åæ ‡ â†’ å›¾åƒåæ ‡                                   â”‚
â”‚  8. æŸ¥æ‰¾layerï¼ˆlego/samæä¾›ï¼‰                            â”‚
â”‚     autoMaskModel.pickLayer(x, y)                       â”‚
â”‚     â†’ è¿”å›AutoMaskLayer | null                           â”‚
â”‚  9. é«˜äº®æ˜¾ç¤ºï¼ˆé¡¹ç›®å®ç°ï¼‰                                 â”‚
â”‚     addBorderToCanvas(layer.maskCanvas, ...)            â”‚
â”‚     â†’ åœ¨selectionCanvasä¸Šç»˜åˆ¶é’è‰²è¾¹æ¡†                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µä¸‰ï¼šç‚¹å‡»ç¡®è®¤                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  10. ç”¨æˆ·ç‚¹å‡»layer                                       â”‚
â”‚      useEventListener('click', handlePickMask)          â”‚
â”‚  11. åˆ‡æ¢é€‰ä¸­çŠ¶æ€ï¼ˆlego/samæä¾›ï¼‰                        â”‚
â”‚      autoMaskModel.toggleLayerMode(x, y)                â”‚
â”‚      â†’ æ›´æ–°layer.modeï¼ˆnull â†” 'source-over'ï¼‰           â”‚
â”‚  12. åˆå¹¶é€‰ä¸­çš„layerï¼ˆlego/samæä¾›ï¼‰                    â”‚
â”‚      autoMaskModel.getMaskResult()                      â”‚
â”‚      â†’ è¿”å›åˆå¹¶åçš„mask Canvas                           â”‚
â”‚  13. æ›´æ–°maskCanvasï¼ˆé¡¹ç›®å®ç°ï¼‰                          â”‚
â”‚      maskResultChange(maskResult.getMask(...))          â”‚
â”‚      â†’ ç»˜åˆ¶åˆ°maskCanvasï¼Œé€šçŸ¥çˆ¶ç»„ä»¶                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€æ€»ç»“

### 5.1 æµç¨‹ç†è§£çº æ­£

**æ‚¨çš„ç†è§£åŸºæœ¬æ­£ç¡®ï¼Œä½†ç¼ºå°‘ï¼š**

1. âŒ åˆå§‹åŒ–é˜¶æ®µçš„ç¼“å­˜æ£€æŸ¥
2. âŒ ç‚¹å‡»ç¡®è®¤å’Œmaskåˆå¹¶æµç¨‹
3. âŒ åæ ‡è½¬æ¢çš„ç»†èŠ‚ï¼ˆpixelRatioã€ç¼©æ”¾ç­‰ï¼‰

### 5.2 èŒè´£åˆ’åˆ†æ ¸å¿ƒ

**lego/samè´Ÿè´£ï¼š**

- æ•°æ®æ¨¡å‹ç®¡ç†ï¼ˆAutoMaskModelã€AutoMaskLayerï¼‰
- æ ¸å¿ƒç®—æ³•ï¼ˆpickLayerã€toggleLayerModeï¼‰
- Maskåˆå¹¶ï¼ˆgetMaskResultï¼‰

**é¡¹ç›®è´Ÿè´£ï¼š**

- APIè°ƒç”¨ä¸ç¼“å­˜
- åæ ‡è½¬æ¢
- äº‹ä»¶å¤„ç†
- UIæ¸²æŸ“ï¼ˆé«˜äº®æ•ˆæœï¼‰
- ä¸šåŠ¡é€»è¾‘

### 5.3 é«˜äº®å®ç°æ ¸å¿ƒ

**æŠ€æœ¯æ–¹æ¡ˆï¼š** å†…é˜´å½±æŠ€æœ¯

- ä½¿ç”¨`destination-in`æ··åˆæ¨¡å¼ä½œä¸ºé®ç½©
- ä½¿ç”¨`shadowBlur`ç”Ÿæˆè¾¹ç¼˜å…‰æ™•
- é‡å¤ç»˜åˆ¶å¼ºåŒ–æ•ˆæœ
- å“åº”å¼è¾¹æ¡†å®½åº¦è®¡ç®—

**å…³é”®æ–‡ä»¶ï¼š**

- `use-auto-masks.ts`ï¼šä¸šåŠ¡é€»è¾‘
- `utils/canvas.ts`ï¼šé«˜äº®æ¸²æŸ“ç®—æ³•
- `@lego/sam`ï¼šåº•å±‚èƒ½åŠ›

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2026-01-15
