# ç¨¿å®š Widget ç³»ç»Ÿè®¾è®¡ï¼ˆRFC 1ï¼‰

## ä¸€ã€æ¦‚è¿°

### 1.1 å®šä¹‰

ç¨¿å®š Widget æ˜¯ä¸€ç§**ä¸º Web ç¼–è¾‘å™¨è®¾è®¡çš„æ’ä»¶ç±»å‹**ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”±å¼€å‘è€…ä»£ç å®ç°çš„å°åŒºå—ï¼Œæ”¯æŒç¼–è¾‘å™¨ç”»å¸ƒå†…å®¹æ‰©å±•ã€‚

> ğŸ’¡ **æ ¸å¿ƒç†å¿µ**  
> Widget æ˜¯ç¼–è¾‘å™¨ä¸­çš„"å¾®æœåŠ¡"ï¼Œå®ƒå°è£…äº†ä¸šåŠ¡é€»è¾‘å’Œ UIï¼Œå¯ä»¥ç‹¬ç«‹å¼€å‘ã€å‘å¸ƒå’Œæ›´æ–°ã€‚

### 1.2 åº”ç”¨åœºæ™¯

**å…¸å‹ç”¨ä¾‹ï¼š**
- ğŸ“Š åˆ›å»ºç¬¬ä¸‰æ–¹æ•°æ®é©±åŠ¨çš„**é”€å”®ä¸šç»©æ’è¡Œæ¦œ**
- ğŸ“ˆ åˆ›å»ºç¬¬ä¸‰æ–¹æ•°æ®é©±åŠ¨çš„**è¡¨æ ¼ã€å›¾è¡¨**
- ğŸ° åˆ›å»º**æŠ½å¥–å°æ¸¸æˆè½¬ç›˜**å¹¶è¿æ¥åˆ°ç¬¬ä¸‰æ–¹æŠ½å¥–ç³»ç»Ÿ
- ğŸ“ åˆ›å»º**è¡¨å•**å¹¶æäº¤æ•°æ®åˆ°ç¬¬ä¸‰æ–¹å¹³å°

### 1.3 å®è·µéªŒè¯

æœ¬ææ¡ˆæ ¸å¿ƒéƒ¨åˆ†å·²ç»åœ¨**ç¨¿å®š Iliad ç¼–è¾‘å™¨**ä¸­å®Œæˆäº†å®è·µéªŒè¯ï¼Œåœ¨å…¶åŸºç¡€ä¸Šä¼˜åŒ–å½¢æˆç³»ç»Ÿæ–¹æ¡ˆï¼Œä»¥é€‚ç”¨äºä¸åŒç¼–è¾‘å™¨ã€‚

---

## äºŒã€è®¾è®¡åŠ¨æœº

### 2.1 ä¿æŒç®€å•å®ç”¨

> ğŸ’­ **ç°çŠ¶åˆ†æ**  
> å½“å‰ç¨¿å®šçš„å½±å“åŠ›è¿˜å¤„äºè¾ƒä¸ºè–„å¼±çš„é˜¶æ®µï¼Œè€Œå¼€å‘è€…ç”Ÿæ€éœ€è¦æ¼«é•¿çš„æ—¶é—´è¿è¥æ‰èƒ½èµ·æ­¥ã€‚

**ä¼˜å…ˆçº§æ’åºï¼š**
1. **å¼€å‘è€…ä½“éªŒ**ï¼ˆæœ€ä¼˜å…ˆï¼‰
2. **å®ç°éš¾åº¦**
3. **èƒ½åŠ›å¼€æ”¾ç¨‹åº¦**

Widget ææ¡ˆèšç„¦è§£å†³å‰ä¸¤ä¸ªé—®é¢˜ï¼Œä¿æŒç®€å•å®ç”¨ã€‚

### 2.2 ä¿æŒå¤–éƒ¨é€‚åº”

> ğŸŒ **å¼€æ”¾ç†å¿µ**  
> åˆ›å»ºçœŸæ­£å¼€æ”¾ä¸”é€æ˜çš„æ’ä»¶æ ¼å¼åŠå…¶å·¥å…·ï¼Œè®© Widget èƒ½éšæ—¶é€‚åº”ç¤¾åŒºç”Ÿæ€ï¼Œä¸ Web å‰ç«¯å·¥ç¨‹èåˆã€‚

**æ ¸å¿ƒä»·å€¼ï¼š**
- âœ… é¿å…å¼€å‘è€…è¢«é”å®šåœ¨ç§æœ‰å¹³å°
- âœ… åŸºäº Web æ ‡å‡†ï¼ŒæŠ€æœ¯æ ˆæ— å…³
- âœ… å¯åœ¨ä¸åŒå‚å•†çš„ä½ä»£ç ç¼–è¾‘å™¨ä¸­ä½¿ç”¨
- âœ… è®¡åˆ’æœªæ¥ä»¥**å¼€æºæ–¹å¼**æä¾›ï¼ˆå¼€æºç‰ˆæœ¬å‘½åä¸º **Web Widget**ï¼‰

---

## ä¸‰ã€æè®®å†…å®¹

### 3.1 ç›®æ ‡

åœ¨ç¨¿å®šå¹³é¢ç¼–è¾‘å™¨ã€ç½‘é¡µç¼–è¾‘å™¨ã€æ–‡ç« ç¼–è¾‘å™¨ç­‰ Web ç¼–è¾‘å™¨ä¸­ä½¿ç”¨**å…±åŒçš„å†…å®¹æ‰©å±•æœºåˆ¶**â€”â€”Widgetã€‚

**å…³é”®ç‰¹æ€§ï¼š**
- ä½¿ç”¨ä¸€è‡´çš„ç¼–è¾‘æ¨¡å¼å’Œå¼€å‘æ¨¡å¼
- ç»Ÿä¸€çš„åŸºæœ¬æ ¼å¼èŒƒå¼
- è®©ä¼ä¸šå®¢æˆ·èƒ½å¤Ÿç®€å•é«˜æ•ˆåœ°é›†æˆä¸šåŠ¡å†…å®¹
- æ”¯æŒ**è‡ªåŠ©**ç®¡ç†ä»£ç èµ„äº§

---

## å››ã€åŸºæœ¬æ¨¡å¼

### 4.1 ç¼–è¾‘æ¨¡å¼

![](attachments/image2023-2-28_20-46-2.png)

ç¼–è¾‘å™¨åœ¨äº§å“å±‚é¢å®šä¹‰ Widget çš„èŒè´£ä»¥åŠåŸºæœ¬ç¼–è¾‘äº¤äº’æ¨¡å¼ï¼Œå¹¶ä¸”å¯¹æ‰€æœ‰ Widget ä¸€è§†åŒä»ã€‚

#### æœ‰é™ç¼–è¾‘

**æ ¸å¿ƒçº¦æŸï¼š**
- âœ… ç”¨æˆ·èƒ½å¤Ÿåˆ©ç”¨ç¼–è¾‘å™¨åŸºæœ¬æ’ç‰ˆåŠŸèƒ½å¯¹ Widget è¿›è¡Œè‡ªç”±æ’ç‰ˆ
- âŒ ä¸èƒ½ç›´æ¥å’Œ Widget å†…éƒ¨å…ƒç´ è¿›è¡Œäº¤äº’ä¿®æ”¹å†…å®¹

**è®¾è®¡ç†å¿µï¼š**
```
Widget è¢«è§†ä½œ"å¤–éƒ¨"å…ƒç´ ï¼Œæ˜¯å°é—­çš„
  â†“
å·¥ä½œæœºåˆ¶éå¸¸ç®€å•
  â†“
åˆ©äº Widget å¼€å‘è€…å’Œç¼–è¾‘å™¨å¼€å‘è€…ç†è§£
```

#### å¯é…ç½®

**å‚æ•°è®¾ç½®ï¼š**
- Widget æ”¯æŒå‚æ•°è®¾ç½®
- é€šè¿‡å‚æ•°è®¾ç½®é¢æ¿æ”¹å˜ Widget å†…éƒ¨å¤–è§‚
- ç¼–è¾‘å™¨è´Ÿè´£å±•ç¤ºå‚æ•°è®¾ç½®é¢æ¿å¹¶è®°å¿†è®¾ç½®æ•°æ®

**è¡¨å•ç”Ÿæˆæ–¹å¼ï¼š**
| æ–¹å¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **è‡ªåŠ¨ç”Ÿæˆ** | ç¼–è¾‘å™¨æ ¹æ® JSON Schema è‡ªåŠ¨ç”Ÿæˆè¡¨å• | ç®€å•é…ç½®ï¼ˆå•é€‰ã€å¤šé€‰ã€è¾“å…¥æ¡†ï¼‰ |
| **è‡ªå®šä¹‰ç•Œé¢** | å¼€å‘è€…æä¾›è‡ªå®šä¹‰çš„å‚æ•°è®¾ç½®è¡¨å• | å¤æ‚äº¤äº’ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€å¯Œæ–‡æœ¬ç¼–è¾‘ï¼‰ |

---

### 4.2 å¼€å‘æ¨¡å¼

Widget ä»å¼€å‘ã€è°ƒè¯•ã€å‘å¸ƒéƒ½é‡‡ç”¨**è¡Œä¸šæ ‡å‡†æˆ–å…¬å…±æœåŠ¡**ï¼Œé¿å…ä½¿ç”¨ç§æœ‰æŠ€æœ¯å’Œå¤šä½™æ¦‚å¿µã€‚

#### å¼€å‘åˆ°å‘å¸ƒæµç¨‹

```
1. å¼€å‘
   â”œâ”€ æ”¯æŒ Reactã€Vue ç­‰ä»»æ„æŠ€æœ¯æ ˆ
   â”œâ”€ é€šè¿‡é€‚é…å™¨åŒ…è£…æˆ Widget ç”Ÿå‘½å‘¨æœŸæ ¼å¼
   â””â”€ æ”¯æŒä»»æ„ Web æ‰“åŒ…æ„å»ºå·¥å…·
      â†“
2. é…ç½®
   â”œâ”€ æä¾›å‚æ•°è®¾ç½®çš„ JSON Schema æè¿°ï¼ˆå¯é€‰ï¼‰
   â”œâ”€ æä¾›è‡ªå®šä¹‰ç”¨æˆ·ç•Œé¢ï¼ˆå¯é€‰ï¼‰
   â””â”€ ä½¿ç”¨ peerDependencies è¿›è¡Œä¾èµ–å…±äº«
      â†“
3. æ„å»º
   â”œâ”€ ä½¿ç”¨ ESM æ ¼å¼ä½œä¸º Widget å…¥å£æ–‡ä»¶
   â””â”€ æ»¡è¶³æµè§ˆå™¨å…¼å®¹è¦æ±‚
      â†“
4. å‘å¸ƒ
   â””â”€ ä½¿ç”¨ NPM æºå‘å¸ƒ Widget åŒ…
```

#### è¿ç§»ä¸è°ƒè¯•

**ç±»ä¼¼æ¦‚å¿µï¼š**
- Islands Architectureï¼ˆå­¤å²›ï¼‰
- å¾®å‰ç«¯

**æ ¸å¿ƒç‰¹æ€§ï¼š**
```
Widget æ˜¯ç¼–è¾‘å™¨ç”»å¸ƒä¸­çš„å­¤å²›
  â†“
ä¸å’Œå…¶ä»–å¤–éƒ¨å…ƒç´ äº§ç”Ÿäº¤äº’
  â†“
ä¸ä¾èµ–å®¿ä¸»ï¼ˆç¼–è¾‘å™¨ï¼‰API
  â†“
ç›´æ¥ä½¿ç”¨ Web API è¿è¡Œ
```

**å¼€å‘ä¼˜åŠ¿ï¼š**
- âœ… å¼€å‘è°ƒè¯•æ— éœ€å¯åŠ¨ç¼–è¾‘å™¨
- âœ… é€šè¿‡ Widget å®¹å™¨ï¼Œåœ¨ä¸åŒ Web å·¥ç¨‹ä¸­è¿ç§»

---

### 4.3 æ ¼å¼æ¨¡å¼

#### åŒ…ç»“æ„

Widget æ˜¯ä¸€ä¸ª**æ ‡å‡†çš„ NPM åŒ…**ï¼š

```json
{
  "name": "@gaoding/demo",
  "version": "0.0.1",
  "description": "An user widget with login ability",
  "exports": {
    ".": "./dist/index.js",
    "./manifest": "./web-widget.json",
    "./data-ui": "./dist/data-ui.js"
  },
  "keywords": ["web-widget"],
  "dependencies": {
    "@web-widget/vue2-adapter": "^1.0.0"
  },
  "peerDependencies": {
    "vue": "^2.6.12"
  },
  "files": [
    "dist",
    "icon",
    "web-widget.json"
  ]
}
```

**å…³é”®å­—æ®µï¼š**
- `exports`ï¼šå®šä¹‰å…¥å£æ–‡ä»¶
- `peerDependencies`ï¼šå…±äº«ä¾èµ–
- `version`ï¼šç‰ˆæœ¬ç®¡ç†

#### ä¸»å…¥å£ï¼ˆ"."ï¼‰

**åŸç”Ÿå®ç°ï¼š**
```javascript
export default () => ({
  async mount({ container, data }) {
    container.innerHTML = `
      <style>
        h3 { color: red }
      </style>
      <h3>${data.title}</h3>
    `;
  }
});
```

**ä½¿ç”¨ UI åº“ï¼ˆé€šè¿‡é€‚é…å™¨ï¼‰ï¼š**
```javascript
import adapter from '@web-widget/vue2-adapter';
import App from './App.vue';

export default adapter(App);
```

#### æ¸…å•ï¼ˆ"./manifest"ï¼‰

```json
{
  "schemaVersion": "0.0.0",
  "displayName": "Web Widget Demo",
  "summary": "The Markdown to use for the main readme of this package.",
  "icons": [
    {
      "src": "icon/lowres.webp",
      "sizes": "64x64",
      "type": "image/webp"
    },
    {
      "src": "icon/hd_hi",
      "sizes": "128x128"
    }
  ],
  "cssProperties": [
    {
      "name": "--text-color",
      "syntax": "<color>",
      "default": "#ff0000",
      "summary": "Set text color"
    }
  ],
  "dataSchema": {
    /* JSON Schema */
  }
}
```

**ç”¨é€”ï¼š**
- åç«¯ç®¡ç†ç³»ç»Ÿè·å–ä¿¡æ¯
- å¢å¼ºå¯è§†åŒ–ç¼–è¾‘å™¨èƒ½åŠ›
- `dataSchema` å­—æ®µï¼šæè¿°å‚æ•°é…ç½®çš„æ•°æ®æ ¼å¼ï¼Œè‡ªåŠ¨ç”Ÿæˆè¡¨å•

#### å‚æ•°è®¾ç½®ç•Œé¢ï¼ˆ"./data-ui"ï¼Œå¯é€‰ï¼‰

```javascript
export default () => ({
  async mount({ data, container }) {
    // æ¸²æŸ“è¡¨å•ç•Œé¢
    const input = document.createElement('input');
    input.value = data.title;
    
    input.onchange = () => {
      // æäº¤æ•°æ®æ›´æ–°
      container.update({ title: input.value });
    }
    
    container.appendChild(input);
  }
});
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- å¤æ‚äº¤äº’ï¼ˆæ–‡ä»¶ä¸Šä¼ ï¼‰
- ç®€å•é…ç½®å¯ä½¿ç”¨ `dataSchema` è‡ªåŠ¨ç”Ÿæˆ

---

## äº”ã€ç±»ä¼¼æ–¹æ¡ˆå¯¹æ¯”

### 5.1 vs Figma Widget

**ç›¸ä¼¼ä¹‹å¤„ï¼š**
- âœ… ç”¨äºæ‰©å±•ç”»å¸ƒå…ƒç´ è€Œä¸æ˜¯æä¾›è‡ªåŠ¨åŒ–

**ä¸åŒä¹‹å¤„ï¼š**

| ç»´åº¦ | Figma Widget | ç¨¿å®š Widget |
|------|--------------|-------------|
| **ç”»å¸ƒäº¤äº’** | å…è®¸åœ¨ç”»å¸ƒä¸­ç›´æ¥äº¤äº’å†…éƒ¨å…ƒç´  | ä¸å¯ä»¥ï¼ˆé™¤éå‘å¸ƒæˆç½‘é¡µï¼‰ |
| **å¹³å°ä¾èµ–** | åªèƒ½åœ¨ Figma æ——ä¸‹äº§å“è¿è¡Œï¼Œä¾èµ– Figma API | ä¸ç‰¹å®šç¼–è¾‘å™¨æ— å…³ï¼Œåªéœ€ Web API |
| **æŠ€æœ¯æ ˆ** | Figma ç§æœ‰ API | Web æ ‡å‡† |

### 5.2 vs Canva åµŒå…¥å¼å…ƒç´ 

Canva ä½¿ç”¨ **Iframely** ä»ç¬¬ä¸‰æ–¹å¹³å°åµŒå…¥åª’ä½“ã€‚

**é™åˆ¶ï¼š**
- âŒ æ— æ³•åµŒå…¥ä»»æ„ HTMLï¼Œåªèƒ½åµŒå…¥ Iframely API æ”¯æŒçš„åª’ä½“
- âŒ Iframe çš„å„ç§ç¼ºç‚¹ï¼Œç¼–è¾‘å™¨æ— æ³•æ§åˆ¶è·¨åŸŸå†…å®¹

### 5.3 vs XXX Plugin

**Figmaã€VSCodeã€Photoshop æ’ä»¶ï¼š**
- ä¸»è¦ç”¨äºæä¾›**è‡ªåŠ¨åŒ–**

**ç¨¿å®š Widgetï¼š**
- ä»…ç”¨äºåˆ›å»º**å†…å®¹**

---

## å…­ã€æŠ€æœ¯æ¶æ„

### 6.1 æ•´ä½“æ¶æ„å›¾

![](attachments/image2023-3-2_15-36-16.png)

### 6.2 æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åº”ç”¨å±‚                    â”‚
â”‚    Widget å®ä¾‹ï¼ˆä¸šåŠ¡é€»è¾‘ + UIï¼‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Widget å®¹å™¨å±‚                â”‚
â”‚   ç”Ÿå‘½å‘¨æœŸç®¡ç† / Shadow DOM éš”ç¦»     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          åŠ è½½å±‚                     â”‚
â”‚   Importmap / ESM CDN / åŒ…å®‰è£…å™¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          åŸºç¡€å±‚                     â”‚
â”‚         NPM / Web æ ‡å‡†              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸ƒã€å…¥å£æ ¼å¼ä¸ç”Ÿå‘½å‘¨æœŸ

### 7.1 å…¥å£æ ¼å¼

**å·¥å‚å‡½æ•°æ¨¡å¼ï¼š**
```javascript
export default () => ({
  async bootstrap(props) {},
  async mount(props) {},
  async update(props) {},
  async unmount(props) {},
  async unload(props) {}
});
```

**å•ä¾‹æ¨¡å¼ï¼š**
```javascript
export async function bootstrap(props) {}
export async function mount(props) {}
export async function update(props) {}
export async function unmount(props) {}
export async function unload(props) {}
```

**çº¦å®šï¼š**
- âœ… æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°éƒ½æ˜¯å¯é€‰çš„
- âœ… ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¿…é¡»è¿”å› `Promise`ï¼ˆå»ºè®®ä½¿ç”¨ `async` å‡½æ•°ï¼‰
- âœ… ç¬¬ä¸€ä¸ª `props` å‚æ•°æ¥æ”¶åº”ç”¨å†…ç½®æ¥å£

### 7.2 ç”Ÿå‘½å‘¨æœŸ

```
load (æ¨¡å—åŠ è½½)
  â†“
bootstrap (åˆå§‹åŒ–ï¼Œä»…é¦–æ¬¡æ‰§è¡Œ)
  â†“
mount (æŒ‚è½½ï¼Œæ¸²æŸ“ UI)
  â†“
update (æ›´æ–°ï¼Œå¯å¤šæ¬¡è§¦å‘)
  â†“
unmount (å¸è½½ï¼Œæ¸…ç†èµ„æº)
  â†“
unload (ç§»é™¤ï¼ŒWidget è¢«åˆ é™¤)
```

#### bootstrapï¼ˆåˆå§‹åŒ–ï¼‰

**æ—¶æœºï¼š** Widget ç¬¬ä¸€æ¬¡æŒ‚è½½å‰æ‰§è¡Œä¸€æ¬¡

**ç”¨é€”ï¼š**
```javascript
export default () => ({
  async bootstrap() {
    // ä¸‹è½½å¿…è¦èµ„æº
    await Promise.all([
      loadCSS('https://cdn.example.com/styles.css'),
      loadBackgroundImage('https://cdn.example.com/bg.jpg'),
      fetchImportantData()
    ]);
  }
});
```

**ä¼˜åŠ¿ï¼š**
- Widget å®¹å™¨å¯èƒ½ä¼šé¢„åŠ è½½
- æå‰æ‰§è¡Œ `bootstrap` å¯æé«˜ç”¨æˆ·ä½“éªŒ

#### mountï¼ˆæŒ‚è½½ï¼‰

**æ—¶æœºï¼š** å°†è‡ªå·±æ¸²æŸ“å‡ºæ¥

**ç¤ºä¾‹ï¼š**
```javascript
export default () => ({
  async mount({ container, data }) {
    // åˆ›å»º DOM å…ƒç´ 
    const element = document.createElement('div');
    element.textContent = data.title;
    
    // æ’å…¥åˆ°å®¹å™¨
    container.appendChild(element);
    
    console.log('mounted!');
  }
});
```

#### updateï¼ˆæ›´æ–°ï¼‰

**æ—¶æœºï¼š** Widget æŒ‚è½½å®Œæˆåï¼Œå¤–éƒ¨è§¦å‘æ›´æ–°

**ç¤ºä¾‹ï¼š**
```javascript
export default () => ({
  async update({ data }) {
    // ä½¿ç”¨æ¡†æ¶æ›´æ–° DOM
    app.updateData(data);
    console.log('updated!', data);
  }
});
```

#### unmountï¼ˆå¸è½½ï¼‰

**æ—¶æœºï¼š** å¸è½½å‡½æ•°è¢«è°ƒç”¨æ—¶

**æ¸…ç†å†…å®¹ï¼š**
```javascript
export default () => ({
  async unmount({ container }) {
    // æ¸…ç† DOM å…ƒç´ 
    container.removeChild(element);
    
    // æ¸…ç†äº‹ä»¶ç›‘å¬
    window.removeEventListener('resize', handler);
    
    // æ¸…ç†å†…å­˜
    instance = null;
    
    console.log('unmounted!');
  }
});
```

**å¿…é¡»æ¸…ç†ï¼š**
- DOM å…ƒç´ 
- äº‹ä»¶ç›‘å¬
- å†…å­˜å¼•ç”¨
- å…¨å±€å˜é‡
- æ¶ˆæ¯è®¢é˜…

#### unloadï¼ˆç§»é™¤ï¼‰

**æ—¶æœºï¼š** Widget è¢«åˆ é™¤å‰

---

## å…«ã€å‘å¸ƒä¸æ›´æ–°

### 8.1 å‘å¸ƒè¦æ±‚

Widget æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ NPM åŒ…ï¼Œå‘å¸ƒåˆ° NPM æºå³å¯ã€‚

**å¿…é¡»ï¼š**
- âœ… ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ç®¡ç†ï¼ˆç¼–è¾‘å™¨ä¾èµ–å®ƒç®¡ç†ç‰ˆæœ¬æ›´æ–°ï¼‰
- âœ… ä½¿ç”¨ ESM æ ¼å¼ï¼Œæ»¡è¶³æµè§ˆå™¨å…¼å®¹è¦æ±‚
- âœ… ä½¿ç”¨ `exports` è€Œä¸æ˜¯ `main` å¯¼å‡ºå…¥å£

**æ¨èï¼š**
- âœ… ä»£ç å‹ç¼©
- âœ… æ’é™¤å¤§å‹ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œå£°æ˜ `peerDependencies`

### 8.2 å®¹å™¨

**Web Components è‡ªå®šä¹‰æ ‡ç­¾ï¼š**
```html
<web-widget
  name="@gaoding/demo"
  version="0.0.1"
  data='{"title": "Hello"}'
></web-widget>
```

**Shadow DOM éš”ç¦»ï¼š**
```html
<web-widget name="@gaoding/demo">
  #shadow-root(open)
    <style>
      h3 { color: red }
    </style>
    <h3>Hello</h3>
</web-widget>
```

**ä½œç”¨ï¼š**
- ç®€åŒ– Web ç¼–è¾‘å™¨å®ç°æ’ä»¶æœºåˆ¶çš„å¤æ‚åº¦
- è®© Widget èƒ½å¤Ÿç§»æ¤åˆ°ä¸åŒ Web å·¥ç¨‹ä¸­
- ç®¡ç† Widget ç”Ÿå‘½å‘¨æœŸ
- é¿å…æ ·å¼å†²çª

### 8.3 å®‰è£…ä¸æ›´æ–°

**æ ¸å¿ƒæœºåˆ¶ï¼š**
```
Widget ä½¿ç”¨ URL å¼‚æ­¥åŠ è½½
  â†“
ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œå®‰è£…ä¸æ›´æ–°
  â†“
ESM NPM CDNï¼šä» NPM è·å–åŒ…å¹¶æä¾›åŠ é€Ÿ
  â†“
Importmapï¼šæä¾›æ¨¡å—åœ°å€æ˜ å°„
  â†“
æœ¬è´¨ï¼šå˜æ›´ CDN åœ°å€å’Œ Importmap é…ç½®
```

---

## ä¹ã€ESM CDN ä¸ Importmap

### 9.1 ESM NPM CDN

![](attachments/image2022-6-16_15-25-5.png)

**åŠŸèƒ½ï¼š**
- ç›´æ¥ä» NPM è·å–åŒ…
- æä¾› CDN åŠ é€Ÿ
- è‡ªåŠ¨è½¬æ¢ CJS ä¸º ESM

**URL æ ¼å¼ï¼š**
```
https://esm.dancf.com/npm:demo-widget@4.17.21/index.js
```

### 9.2 Importmap

**å®šä¹‰ï¼š**  
Importmapï¼ˆå¯¼å…¥æ˜ å°„ï¼‰æ˜¯ WICG æå‡ºçš„æ–°ææ¡ˆï¼Œæ§åˆ¶ JavaScript çš„æ¨¡å—åŠ è½½è¡Œä¸ºã€‚

**é—®é¢˜ï¼š**
```html
<script type="module">
  import _ from 'lodash';  // âŒ æµè§ˆå™¨æŠ¥é”™
  _.clone({})
</script>
```

![](attachments/image2022-12-8_13-41-45.png)

**è§£å†³æ–¹æ¡ˆï¼š**
```html
<script type="importmap">
{
  "imports": {
    "lodash": "https://esm.dancf.com/npm:lodash@4.17.21/index.js"
  }
}
</script>

<script type="module">
  import _ from 'lodash';  // âœ… æ­£å¸¸å·¥ä½œ
  _.clone({})
</script>
```

**ç‰ˆæœ¬ç®¡ç†ï¼š**
```html
<script type="importmap">
{
  "imports": {
    "demo-widget": "https://esm.dancf.com/npm:demo-widget@1.0.0/index.js"
  }
}
</script>

<!-- å®‰è£… Widget -->
<web-widget name="demo-widget"></web-widget>
```

**æµè§ˆå™¨æ”¯æŒï¼š**
- âœ… Chrome 89+ åŸç”Ÿæ”¯æŒ
- âœ… é€šè¿‡å«ç‰‡æ”¯æŒæ›´ä½ç‰ˆæœ¬æµè§ˆå™¨

### 9.3 åŒ…å®‰è£…å™¨

**ä½œç”¨ï¼š**  
ä¸“é—¨ç”¨äºå¤„ç† Importmap çš„ç”Ÿæˆ

**å¼€æºåº“ï¼š**  
https://github.com/jspm/generator

---

## åã€ä¾èµ–å…±äº«

### 10.1 ä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–å…±äº«ï¼Ÿ

Widget å¯èƒ½ä¾èµ–ç¬¬ä¸‰æ–¹æ¨¡å—ï¼ˆå¦‚ Vueã€Reactï¼‰ï¼Œé€šè¿‡ä¾èµ–å…±äº«å¯ä»¥ï¼š
- âœ… å‡å°‘åŒ…ä½“ç§¯
- âœ… é¿å…é‡å¤åŠ è½½
- âœ… æé«˜æ€§èƒ½

### 10.2 å®ç°æ–¹å¼

**Step 1ï¼špackage.json å£°æ˜**
```json
{
  "peerDependencies": {
    "vue": "^2.6.12",
    "lodash": "^4.17.21"
  }
}
```

**Step 2ï¼šæ„å»ºæ—¶æ’é™¤**
```javascript
// vite.config.js
export default {
  build: {
    rollupOptions: {
      external: ['vue', 'lodash']
    }
  }
}
```

**Step 3ï¼šImportmap é…ç½®**
```json
{
  "imports": {
    "vue": "https://esm.dancf.com/npm:vue@2.6.12/dist/vue.esm.browser.js",
    "lodash": "https://esm.dancf.com/npm:lodash@4.17.21/lodash.js",
    "@gaoding/widget-a": "https://esm.dancf.com/npm:@gaoding/widget-a@1.0.0/index.js",
    "@gaoding/widget-b": "https://esm.dancf.com/npm:@gaoding/widget-b@1.0.0/index.js"
  }
}
```

**ç»“æœï¼š**
```
Widget A å’Œ Widget B å…±äº« Vue å’Œ lodash
åªåŠ è½½ä¸€æ¬¡ï¼ŒèŠ‚çœå¸¦å®½å’Œå†…å­˜
```

---

## åä¸€ã€é«˜çº§ç‰¹æ€§

### 11.1 å¯¼å‡ºåˆ°å›¾ç‰‡

**éœ€æ±‚ï¼š**  
Widget éœ€è¦æ”¯æŒå¯¼å‡ºä¸ºå›¾ç‰‡

**å®ç°ï¼šä½¿ç”¨ SVG foreignObject**
```javascript
const content = webWidget.shadowRoot.innerHTML;
const xhtml = new XMLSerializer().serializeToString(content);

return `
  <svg xmlns="http://www.w3.org/2000/svg">
    <foreignObject width="100%" height="100%">
      <div xmlns="http://www.w3.org/1999/xhtml">
        ${xhtml}
      </div>
    </foreignObject>
  </svg>
`;
```

**é™åˆ¶ï¼š**  
SVG çš„ foreignObject èƒ½åŠ›æœ‰ä¸€äº›é™åˆ¶ï¼ˆä¸åœ¨æœ¬ææ¡ˆæ ¸å¿ƒå†…å®¹å±•å¼€ï¼‰

### 11.2 SEO

**é—®é¢˜ï¼š**  
Widget åŸºäº Web Componentsï¼Œéœ€è¦è§£å†³ SEO é—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼šShadow DOM åºåˆ—åŒ–**
```html
<web-widget>
  <template shadowrootmode="open">
    <h3>Hello World</h3>
  </template>
</web-widget>
```

**æµ‹è¯•ç»“æœï¼š**
- âœ… Google æ”¯æŒæ”¶å½•åºåˆ—åŒ–åçš„ shadow DOM å†…å®¹
- âœ… ç™¾åº¦æ”¯æŒæ”¶å½•åºåˆ—åŒ–åçš„ shadow DOM å†…å®¹

**æµè§ˆå™¨æ”¯æŒï¼š**
- Chromeï¼šåŸç”Ÿæ”¯æŒ
- å…¶ä»–æµè§ˆå™¨ï¼šé€šè¿‡å°‘é‡å«ç‰‡ä»£ç æ”¯æŒ

---

## åäºŒã€å®‰å…¨ç­–ç•¥

### 12.1 å®‰å…¨æŒ‘æˆ˜

> âš ï¸ **æ ¸å¿ƒé—®é¢˜**  
> JS è¯­è¨€ç‰¹æ€§å®¹æ˜“è·å–å…¨å±€å˜é‡ï¼Œè¿è¡Œç¬¬ä¸‰æ–¹ä»£ç ä¼šå¯¹åº”ç”¨å®‰å…¨é€ æˆéšæ‚£ã€‚

**ç°çŠ¶ï¼š**  
Web æ ‡å‡†ä¸­å°šæœªæä¾›ç†æƒ³çš„è¿è¡Œç¬¬ä¸‰æ–¹ä»£ç çš„æœºåˆ¶ï¼Œéœ€è¦å¼€å‘è€…å°å¿ƒå¤„ç†ã€‚

### 12.2 æ–¹æ¡ˆä¸€ï¼šIframe Sandbox æ¨¡å¼

![](attachments/image2023-3-2_17-1-20.png)

**å®ç°ï¼š**
- Iframe çš„ `sandbox` å±æ€§æˆ–è·¨åŸŸ URL é™åˆ¶ç¬¬ä¸‰æ–¹ä»£ç æƒé™
- **å…³é”®**ï¼šè®©ç¼–è¾‘å™¨çš„æ¸²æŸ“å±‚ï¼ˆç”»å¸ƒä¸æ ¸å¿ƒäº¤äº’ï¼‰éƒ½æ”¾åœ¨æ²™ç›’åŒ–çš„ Iframe ä¸­
- å€ŸåŠ© Iframe postMessage API ä¸å¤–ä¾§çš„ä¸šåŠ¡å±‚é€šè®¯

**æ¶æ„ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¸šåŠ¡å±‚ï¼ˆä¸»çª—å£ï¼‰             â”‚
â”‚   ç”¨æˆ·æ•°æ® / æ•æ„Ÿä¿¡æ¯ / API         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ postMessage
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¸²æŸ“å±‚ï¼ˆæ²™ç›’åŒ– Iframeï¼‰            â”‚
â”‚   ç¼–è¾‘å™¨ç”»å¸ƒ / Widget å®¹å™¨          â”‚
â”‚   â”œâ”€ å†…ç½®å…ƒç´                        â”‚
â”‚   â””â”€ Widget å®ä¾‹ï¼ˆç¬¬ä¸‰æ–¹ä»£ç ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿ï¼š**
- âœ… ç¬¬ä¸‰æ–¹ Widget æ— æ³•ç©¿è¶Šæ²™ç›’éš”ç¦»å±‚
- âœ… æ— æ³•è·å–æ•æ„Ÿæ•°æ®
- âœ… æ— æ³•å®æ–½æ”»å‡»

**ç¼ºç‚¹ï¼š**
- âš ï¸ Widget ä¾ç„¶å¯èƒ½ç ´åæ¸²æŸ“å±‚å†…å®¹

### 12.3 æ–¹æ¡ˆäºŒï¼šWeb Worker + SSR æ¨¡å¼

![](attachments/image2023-3-3_19-32-46.png)

**æ ¸å¿ƒæ€æƒ³ï¼š**
```
Widget çº¦å®šäº†"æœ‰é™ç¼–è¾‘"æ¨¡å¼
  â†“
å†…éƒ¨å…ƒç´ ä¸ä¸ç”¨æˆ·äº¤äº’
  â†“
JS åªéœ€å®Œæˆæ¸²æŸ“
  â†“
ç±»ä¼¼ç»„ä»¶çš„ SSR æ¨¡å¼
```

**æ¶æ„ï¼š**
- **ç¼–è¾‘å™¨ä¸­**ï¼šä½¿ç”¨ Web Worker è¿è¡Œ SSR ç‰ˆæœ¬
- **è½åœ°é¡µä¸­**ï¼šä½¿ç”¨é»˜è®¤ç‰ˆæœ¬ï¼ˆå®¢æˆ·ç«¯æ¸²æŸ“ï¼‰

**package.json é…ç½®ï¼š**
```json
{
  "exports": {
    ".": {
      "worker": "./dist/ssr.js",
      "default": "./dist/index.js"
    }
  }
}
```

**SSR ç‰ˆæœ¬ç¤ºä¾‹ï¼š**
```javascript
import { createSSRApp } from 'vue';
import { renderToWebStream } from 'vue/server-renderer';
import App from './App.vue';

export async function response({ data }) {
  const app = createSSRApp(App);
  const stream = await renderToWebStream(app);
  return new Response(stream, {
    status: 200,
    headers: { 'Content-Type': 'text/html' }
  });
}
```

**ä¼˜åŠ¿ï¼š**
- âœ… Web Worker ä½œä¸ºæ²™ç›’ï¼ˆéœ€æ³¨æ„ç½‘ç»œè¯·æ±‚ä¼šæºå¸¦ Cookieï¼‰
- âœ… ä¸»æµå‰ç«¯ UI åº“æ”¯æŒåœ¨æ­¤ç¯å¢ƒä¸­æ¸²æŸ“
- âœ… è§£å†³å®‰å…¨é—®é¢˜çš„åŒæ—¶ï¼Œä¹Ÿè§£å†³äº†å®æ—¶ SEO é—®é¢˜

**æ³¨æ„ï¼š**  
è‡ªå®šä¹‰å‚æ•°è®¾ç½®é¢æ¿éœ€è¦ä¸ç”¨æˆ·äº¤äº’ï¼Œåº”ä½¿ç”¨ Iframe sandbox è¿è¡Œã€‚

### 12.4 æ–¹æ¡ˆä¸‰ï¼šWeb Sandbox æ¨¡å¼

![](attachments/image2023-3-3_19-36-26.png)

**é¡¹ç›®ä»‹ç»ï¼š**  
ä¸º Widget æä¾›ç†æƒ³çš„ DOM æ¸²æŸ“å®‰å…¨æ²™ç›’ç¯å¢ƒçš„é¡¹ç›®ã€‚

**æ ¸å¿ƒèƒ½åŠ›ï¼š**
- è™šæ‹Ÿ DOM æ ‘
- å†…å®¹å®‰å…¨ç­–ç•¥
- æœ¬åœ°å­˜å‚¨éš”ç¦»
- Web Components æ”¯æŒ
- Viewport éš”ç¦»
- Task éš”ç¦»
- éš”ç¦» XSS æ”»å‡»

**æ”¯æŒï¼š**
- âœ… ä¸»æµå‰ç«¯ UI åº“è¿è¡Œç¯å¢ƒ

**æ¼”ç¤ºï¼š**  
https://web-sandbox.js.org/

### 12.5 æ–¹æ¡ˆå››ï¼šWorker DOM æ¨¡å¼

**ç®€ä»‹ï¼š**  
Google AMP é¡¹ç›®ç»„æ¨å‡ºï¼Œå’Œ Web Sandbox ç±»ä¼¼

**ç¼ºç‚¹ï¼š**
- âŒ ä¸ä¸»æµå‰ç«¯åº“å…¼å®¹æ€§è¾ƒå·®

### 12.6 æ–¹æ¡ˆäº”ï¼šä¿å®ˆå®‰å…¨è¿è¥ç­–ç•¥

**éæŠ€æœ¯æ–¹æ¡ˆï¼Œè€Œæ˜¯äº§å“è¿è¥ç­–ç•¥ï¼š**

**æªæ–½ï¼š**
1. ä»…æ”¯æŒå®‰è£… NPM ç™½åå•å†…çš„ç»„ç»‡è´¦å·çš„åŒ…ï¼ˆå¦‚ `@gaoding-inc/`ï¼‰
2. é‡‡ç”¨äººå·¥å®¡æ ¸ Widget

**æ¡ˆä¾‹ï¼š**  
è™½ç„¶ Figma æœ‰è‡ªå·±çš„æ²™ç›’æœºåˆ¶ï¼Œä½†ä¾ç„¶å¯¹æ¯ä¸ªæ’ä»¶è¿›è¡Œäººå·¥å®¡æ ¸ã€‚

**é€‚ç”¨é˜¶æ®µï¼š**  
æ—©æœŸé˜¶æ®µé‡‡ç”¨ä¿å®ˆç­–ç•¥æ˜¯è¡Œä¹‹æœ‰æ•ˆçš„æ–¹å¼ã€‚

### 12.7 ä¸ºä»€ä¹ˆä¸æ˜¯å…¶ä»–æ–¹æ¡ˆï¼Ÿ

#### âŒ Figma Sandbox

**é—®é¢˜ï¼š**
- Figma ä½¿ç”¨ç¬¬ä¸‰æ–¹ JS å¼•æ“å®ç°æ²™ç›’è¿è¡Œæ’ä»¶é€»è¾‘å±‚
- ä½¿ç”¨æµè§ˆå™¨ Iframe è¿è¡Œæ’ä»¶ UI å±‚
- Widget æ ¸å¿ƒèŒè´£æ˜¯ç»˜åˆ¶ UIï¼Œç¬¬ä¸‰æ–¹ JS å¼•æ“æ— æ³•æä¾› DOM ç¯å¢ƒ

#### âŒ ES6 Proxy Sandbox

**é—®é¢˜ï¼š**
- å›½å†…ä¸€äº›å¾®å‰ç«¯åº“çš„åŸºæœ¬å®ç°åŸç†
- æ— æ³•æ‹’ç»æ¶æ„ä»£ç æ‰§è¡Œ
- å¤§å¤šæ•°æ— æ³•é€šè¿‡ Web Sandbox æä¾›çš„ XSS ç”¨ä¾‹

### 12.8 æ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | Iframe Sandbox | Web Worker + SSR | Web Sandbox | Worker DOM |
|------|----------------|------------------|-------------|------------|
| **ç¼–è¾‘å™¨å®ç°éš¾åº¦** | ä¸­ | ä¸­ | ä½ | ä¸­ |
| **Widget å®¹å™¨å®ç°éš¾åº¦** | ä½ | ä¸­ | é«˜ | é«˜ |
| **ESM æ”¯æŒ** | âœ… | âœ… [1] | âœ… | âœ… [2] |
| **Importmap æ”¯æŒ** | âœ… | âŒ | âœ… | âŒ |
| **Web API æ•°é‡** | å¤š | å°‘ | å¤š | å°‘ |
| **ç»„ä»¶çº§éš”ç¦»** | âŒ | âœ… | âœ… | âœ… |

**æ³¨é‡Šï¼š**
- [1] éœ€è¦å¤„ç†æµè§ˆå™¨å…¼å®¹é—®é¢˜
- [2] æ”¯æŒ system æ ¼å¼ï¼Œä½œä¸º ESM ä»£æ›¿å“

---

## åä¸‰ã€è¿­ä»£ç­–ç•¥

### 13.1 æ™®é€šç”¨æˆ·

å¯¹ç”¨æˆ·ä½¿ç”¨**"å°æŒ‚ä»¶"**çš„æ¦‚å¿µåœ¨ç¼–è¾‘å™¨ä¸­å‘ˆç°ã€‚

### 13.2 å¼€å‘è€…

**å¼€æ”¾ç­–ç•¥ï¼š**

Web æ’ä»¶çš„å®‰å…¨æœºåˆ¶æ˜¯æ¯”æ’ä»¶æœºåˆ¶æ›´å¤æ‚çš„è¯¾é¢˜ï¼Œåœ¨å½¢æˆå ¡å’èˆ¬çš„å®‰å…¨æœºåˆ¶ä¹‹å‰ï¼Œåº”å½“ä»¥**ä¿å®ˆæ–¹å¼å¼€æ”¾**ï¼š

```
ç¼–è¾‘å™¨å†…éƒ¨å¼€å‘è€…
  â†“
SKA å¼€å‘è€…
  â†“
ç‰¹å®šä¼ä¸šå¼€å‘è€…
  â†“
ï¼ˆå®‰å…¨æ¨¡å‹æ„å»ºå®Œæˆï¼‰
  â†“
å…¨éƒ¨å¼€æ”¾
```

---

## åå››ã€æœªæ¥å¯èƒ½æ€§

### 14.1 è‡ªåŠ¨ç”Ÿæˆä¼ä¸šåŠ¨æ€å†…å®¹

**åœºæ™¯ï¼š**  
é€šè¿‡æœåŠ¡å™¨æ¸²æŸ“ï¼Œåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ Widgetï¼Œæ‰¹é‡ç”Ÿæˆä¼ä¸šä¸šåŠ¡æ•°æ®é©±åŠ¨çš„å›¾ç‰‡å†…å®¹ã€‚

**æµç¨‹ï¼š**
```
ä¼ä¸šæ•°æ®
  â†“
æœåŠ¡å™¨è¿è¡Œ Widget SSR
  â†“
ç”ŸæˆåŠ¨æ€å›¾ç‰‡
  â†“
æ‰¹é‡è¾“å‡º
```

### 14.2 æ‰©å±•ç§æœ‰æ¥å£

**æŠ€æœ¯å¯è¡Œæ€§ï¼š**  
Widget åœ¨æŠ€æœ¯å±‚é¢å…è®¸åœ¨åŸºæœ¬æ¨¡å¼ä¸Šæ‰©å±•ç§æœ‰ APIï¼Œåˆ©ç”¨ç¼–è¾‘å™¨ç‰¹æœ‰ API å®ç°æ›´å¤šæ•ˆæœã€‚

**å»ºè®®ï¼š**  
è™½ç„¶åŸºæœ¬æ¨¡å¼å…è®¸æ‰©å±•ï¼Œä½†**ä¸æ¨èè¿‡æ—©è¿™æ ·åš**ã€‚

### 14.3 é€šè¿‡æ’æ§½ç»„åˆå…ƒç´ 

**èƒ½åŠ›ï¼š**  
Widget å®¹å™¨é»˜è®¤ä½¿ç”¨ shadow DOMï¼Œå¯æä¾›åŸç”Ÿæ’æ§½èƒ½åŠ›ï¼Œç¼–è¾‘å™¨å¯å°†ä¸åŒå…ƒç´ æ”¾åœ¨ Widget å†…éƒ¨ã€‚

**Widget ä»£ç ï¼š**
```javascript
export default () => ({
  async mount({ container }) {
    container.innerHTML = `
      <slot name="title">
        <h3>Default title</h3>
      </slot>
      <slot name="content">
        Default content
      </slot>
    `;
  }
});
```

**æ¸…å•å®šä¹‰ï¼š**
```json
{
  "slots": [
    {
      "name": "title",
      "summary": "Title slot"
    },
    {
      "name": "content",
      "summary": "Content slot"
    }
  ]
}
```

**ä½¿ç”¨ï¼š**
```html
<web-widget name="@gaoding/demo">
  <div slot="title">hello</div>
  <div slot="content">Let's have some different text!</div>
</web-widget>
```

---

## åäº”ã€æ€»ç»“

### 15.1 æ ¸å¿ƒè®¾è®¡

1. **ç®€å•å®ç”¨**  
   ä¼˜å…ˆè€ƒè™‘å¼€å‘è€…ä½“éªŒå’Œå®ç°éš¾åº¦

2. **å¤–éƒ¨é€‚åº”**  
   åŸºäº Web æ ‡å‡†ï¼ŒæŠ€æœ¯æ ˆæ— å…³ï¼Œå¯å¼€æº

3. **ä¸‰ç§æ¨¡å¼**  
   ç¼–è¾‘æ¨¡å¼ã€å¼€å‘æ¨¡å¼ã€æ ¼å¼æ¨¡å¼ç»Ÿä¸€

4. **æ ‡å‡†åŒ–**  
   åŸºäº NPMã€ESMã€Importmap ç­‰è¡Œä¸šæ ‡å‡†

5. **å®‰å…¨å¯æ§**  
   æä¾›å¤šç§å®‰å…¨ç­–ç•¥æ–¹æ¡ˆ

### 15.2 å…³é”®ç‰¹æ€§

**ç¼–è¾‘ä½“éªŒï¼š**
- âœ… æœ‰é™ç¼–è¾‘ï¼ˆå°é—­ä½†å¯é…ç½®ï¼‰
- âœ… å‚æ•°è®¾ç½®ï¼ˆè‡ªåŠ¨ç”Ÿæˆæˆ–è‡ªå®šä¹‰ï¼‰
- âœ… è‡ªç”±æ’ç‰ˆ

**å¼€å‘ä½“éªŒï¼š**
- âœ… ä»»æ„æŠ€æœ¯æ ˆï¼ˆReactã€Vue ç­‰ï¼‰
- âœ… ä»»æ„æ„å»ºå·¥å…·
- âœ… æ ‡å‡† NPM åŒ…
- âœ… æ— éœ€å¯åŠ¨ç¼–è¾‘å™¨å³å¯å¼€å‘è°ƒè¯•

**æŠ€æœ¯æ¶æ„ï¼š**
- âœ… åŸºäº Web Components
- âœ… Shadow DOM éš”ç¦»
- âœ… ESM + Importmap
- âœ… ä¾èµ–å…±äº«

**å®‰å…¨ç­–ç•¥ï¼š**
- âœ… Iframe Sandbox
- âœ… Web Worker + SSR
- âœ… Web Sandbox
- âœ… ä¿å®ˆè¿è¥ç­–ç•¥

### 15.3 åº”ç”¨åœºæ™¯

**å½“å‰ï¼š**
- æ•°æ®å¯è§†åŒ–ï¼ˆå›¾è¡¨ã€æ’è¡Œæ¦œï¼‰
- äº¤äº’ç»„ä»¶ï¼ˆè¡¨å•ã€æŠ½å¥–ï¼‰
- ç¬¬ä¸‰æ–¹é›†æˆ

**æœªæ¥ï¼š**
- æœåŠ¡å™¨ç«¯æ‰¹é‡ç”Ÿæˆ
- ç§æœ‰ API æ‰©å±•
- æ’æ§½ç»„åˆ

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0 (RFC 1)*  
*æœ€åæ›´æ–°ï¼š2025-01-26*  
*åŸå§‹æ–‡æ¡£ï¼šConfluence - RFC 1: ç¨¿å®š Widget*
