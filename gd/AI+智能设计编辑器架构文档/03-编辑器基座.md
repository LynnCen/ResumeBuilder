# 03 - 编辑器基座

> **导航**：[📚 返回总目录](./README.md) | [⬅️ 上一篇：整体架构设计](./02-整体架构设计.md) | [➡️ 下一篇：扩展插件系统](./04-扩展插件系统.md)
>
> **所属**：AI+ 智能设计编辑器架构文档

---

## 3.1 基座的设计哲学

**核心思想**：把复杂的初始化流程封装成一行代码。

```javascript
// 应用层只需要这一行！
await installDesign('#app', config);
```

**背后发生了什么？**（7步标准化流程）

```
第1步：环境初始化
  ├─ 设置 API 域名（国内/国外）
  ├─ 注入环境变量（HOME_PAGE, REGION...）
  └─ 配置 OSS/CDN

第2步：API 服务初始化
  ├─ 创建 HTTP 客户端
  ├─ 配置拦截器（鉴权、错误处理）
  └─ 注册业务 API（用户、模板、AI...）

第3步：权限系统初始化
  ├─ 加载权限配置
  ├─ 初始化权限控制器
  └─ 设置功能开关（哪些能力可用）

第4步：创建 Vue 应用
  ├─ 创建 Vue 实例
  ├─ 注册 Pinia（状态管理）
  ├─ 注册 Router（路由）
  └─ 注册全局组件

第5步：插件注册
  ├─ 加载扩展配置（extensionConfig）
  ├─ 依次注册每个插件
  └─ 调用插件的 register 钩子

第6步：日志服务初始化
  ├─ 配置日志上报（SLS）
  ├─ 设置错误监控
  └─ 初始化埋点系统

第7步：编辑器挂载
  ├─ 渲染编辑器组件
  ├─ 初始化画布
  ├─ 触发 mounted 生命周期
  └─ 完成启动 ✅
```

**为什么这样设计？**

- 保证初始化顺序（有些服务依赖其他服务）
- 统一错误处理（任一步失败都能优雅降级）
- 便于扩展（新增服务只需插入对应步骤）

---

## 3.2 国内版 vs 国际版 - 多租户架构实践

两个版本**共享 95% 的代码**，只有这些地方不同：

| 差异维度   | design-ai-plus (国内)  | insmind-ai-plus (国际)  | 实现方式                  |
| ---------- | ---------------------- | ----------------------- | ------------------------- |
| **登录**   | 手机号 + 短信验证码    | Google OAuth 2.0        | 配置 `env.LOGIN_TYPE`     |
| **API**    | https://api.huaban.com | https://api.insmind.com | 配置 `env.API_BASE_URL`   |
| **存储**   | 阿里云 OSS             | AWS S3                  | 配置 `env.STORAGE_TYPE`   |
| **CDN**    | 国内 CDN               | Cloudflare              | 配置 `env.CDN_DOMAIN`     |
| **AI服务** | 国内部署模型           | 海外部署模型            | 配置 `env.AI_SERVICE_URL` |
| **支付**   | 支付宝 + 微信支付      | Stripe                  | 配置 `env.PAYMENT_TYPE`   |
| **语言**   | 中文优先               | 英文优先                | 配置 `env.DEFAULT_LOCALE` |

**多租户架构的关键**：

```
核心原则：通过配置驱动差异，而不是代码分支

错误示范：
  if (isChina) {
    useAlipay();
  } else {
    useStripe();
  }

正确做法：
  const PaymentProvider = config.paymentType; // 动态注入
  PaymentProvider.pay(amount);
```

**配置管理**：

```
/apps/design-ai-plus/src/configs/
  ├── env.ts          ← 环境配置（API域名、登录方式...）
  ├── apis.ts         ← API端点配置
  └── extensions.ts   ← 插件配置（哪些插件启用）

/apps/insmind-ai-plus/src/configs/
  ├── env.ts          ← 不同的环境配置
  ├── apis.ts         ← 不同的API端点
  └── extensions.ts   ← 不同的插件配置
```

---

> **下一步**：了解 [扩展插件系统](./04-扩展插件系统.md) 如何支持灵活扩展。
